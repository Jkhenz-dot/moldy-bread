<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>:v Faces Mascots Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1a1b23;
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #1a1b23;
            position: relative;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .login-box {
            background: rgba(42, 43, 55, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 48px;
            width: 440px;
            max-width: 90vw;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05);
            position: relative;
            z-index: 1;
        }

        .login-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
        }

        .login-input {
            width: 100%;
            padding: 18px 24px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: white;
            font-size: 16px;
            margin-bottom: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .login-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .login-btn:hover::before {
            opacity: 1;
        }

        .login-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .login-btn span {
            position: relative;
            z-index: 1;
        }

        .error-message {
            color: #ef4444;
            margin-top: 15px;
            font-size: 14px;
        }

        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1b23 0%, #242530 50%, #2a2b3d 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            overflow: hidden;
        }

        .loading-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%);
            pointer-events: none;
        }

        /* Light mode loading screen */
        body.light-mode .loading-screen {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 50%, #e2e8f0 100%);
        }

        body.light-mode .loading-screen::before {
            background: radial-gradient(circle at 30% 20%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
        }

        .loading-content {
            text-align: center;
            max-width: 560px;
            padding: 48px;
            position: relative;
            z-index: 1;
        }

        .loading-logo {
            font-size: 56px;
            font-weight: 800;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite;
            letter-spacing: -0.025em;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .loading-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .loading-subtitle {
            font-size: 16px;
            color: #a0a0a0;
            margin-bottom: 40px;
        }

        .loading-steps {
            background: rgba(42, 43, 55, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
        }

        .loading-step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 16px;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .loading-step:last-child {
            margin-bottom: 0;
        }

        .loading-step.active {
            background: rgba(99, 102, 241, 0.1);
            border-left: 3px solid #6366f1;
            border-color: rgba(99, 102, 241, 0.2);
        }

        .loading-step.completed {
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid #22c55e;
            border-color: rgba(34, 197, 94, 0.2);
        }

        .step-icon {
            font-size: 20px;
            margin-right: 15px;
            width: 30px;
            text-align: center;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: iconPulse 2s infinite ease-in-out;
        }

        .loading-step.completed .step-icon {
            background: linear-gradient(135deg, #10b981, #22c55e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: iconGlow 1s ease-in-out;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes iconGlow {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.2); filter: brightness(1.5); }
        }

        .step-text {
            flex: 1;
            font-size: 16px;
            font-weight: 500;
        }

        .step-status {
            font-size: 12px;
            color: #a0a0a0;
            margin-left: 10px;
        }

        .loading-step.active .step-status {
            color: #7c3aed;
        }

        .loading-step.completed .step-status {
            color: #22c55e;
        }

        .loading-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 6px;
        }

        .loading-details {
            font-size: 14px;
            color: #a0a0a0;
            margin-top: 10px;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
        }

        .header {
            background: rgba(42, 43, 55, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .mobile-menu-toggle {
            display: none;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Light Theme Styles */
        body.light-theme {
            background: #fafafa;
            color: #0f172a;
        }

        body.light-theme .login-container {
            background: #fafafa;
        }

        body.light-theme .login-container::before {
            background: radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 70%);
        }

        body.light-theme .login-box {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.05);
        }

        body.light-theme .login-input {
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #0f172a;
        }

        body.light-theme .login-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: rgba(255, 255, 255, 0.8);
        }

        body.light-theme .login-input::placeholder {
            color: rgba(0, 0, 0, 0.4);
        }

        body.light-theme .loading-screen {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 25%, #e2e8f0 50%, #f8fafc 75%, #ffffff 100%);
            width: 100vw !important;
            height: 100vh !important;
            min-height: 100vh !important;
            position: fixed !important;
            overflow: hidden;
        }

        body.light-theme .loading-screen::before {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.12) 0%, transparent 40%),
                        radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.10) 0%, transparent 40%),
                        radial-gradient(circle at 50% 10%, rgba(79, 70, 229, 0.08) 0%, transparent 50%),
                        linear-gradient(45deg, rgba(99, 102, 241, 0.03) 0%, transparent 30%, rgba(139, 92, 246, 0.03) 70%, transparent 100%);
            animation: lightModeFloat 12s ease-in-out infinite;
            pointer-events: none;
        }

        body.light-theme .loading-screen::after {
            content: '';
            position: absolute !important;
            top: -50% !important;
            left: -50% !important;
            width: 200vw !important;
            height: 200vh !important;
            background: conic-gradient(from 0deg at 50% 50%, 
                rgba(99, 102, 241, 0.02) 0deg, 
                transparent 90deg, 
                rgba(139, 92, 246, 0.03) 180deg, 
                transparent 270deg, 
                rgba(99, 102, 241, 0.02) 360deg);
            animation: lightModeRotate 20s linear infinite;
            pointer-events: none;
        }

        @keyframes lightModeFloat {
            0%, 100% { 
                transform: translateY(0px) scale(1);
                opacity: 1;
            }
            50% { 
                transform: translateY(-10px) scale(1.02);
                opacity: 0.8;
            }
        }

        @keyframes lightModeRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        body.light-theme .loading-steps {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        body.light-theme .loading-step {
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        body.light-theme .loading-step.active {
            background: rgba(99, 102, 241, 0.08);
            border-left: 3px solid #6366f1;
            border-color: rgba(99, 102, 241, 0.15);
        }

        body.light-theme .loading-step.completed {
            background: rgba(34, 197, 94, 0.08);
            border-left: 3px solid #22c55e;
            border-color: rgba(34, 197, 94, 0.15);
        }

        body.light-theme .loading-progress {
            background: rgba(0, 0, 0, 0.08);
        }

        body.light-theme .header {
            background: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        body.light-theme .theme-toggle {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #0f172a;
        }

        body.light-theme .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
        }

        /* Yellow sun icon in light mode */
        body.light-theme .theme-toggle .fa-sun {
            color: #fbbf24 !important;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        /* Light Theme - Modern Components */
        body.light-theme .sidebar {
            background: rgba(255, 255, 255, 0.8);
            border-right: 1px solid rgba(0, 0, 0, 0.08);
        }

        body.light-theme .nav-item {
            color: rgba(0, 0, 0, 0.6);
        }

        body.light-theme .nav-item:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.12), rgba(139, 92, 246, 0.12));
            border-left-color: #6366f1;
        }

        body.light-theme .nav-item:hover .nav-text {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }



        body.light-theme .nav-item.active .nav-icon {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }



        body.light-theme .card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.12);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        body.light-theme .card::before {
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.4), transparent);
        }

        body.light-theme .card:hover {
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
        }

        body.light-theme .trend-card {
            background: rgba(99, 102, 241, 0.08);
            border: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12);
        }

        body.light-theme .trend-card:hover {
            box-shadow: 0 20px 60px rgba(99, 102, 241, 0.2);
        }

        body.light-theme .stat-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        body.light-theme .stat-card:hover {
            border-color: rgba(99, 102, 241, 0.2);
        }

        body.light-theme .stat-value {
            color: #6366f1;
        }

        body.light-theme .stat-label {
            color: rgba(0, 0, 0, 0.6);
        }

        body.light-theme .form-input, 
        body.light-theme .form-textarea, 
        body.light-theme .form-select {
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #0f172a;
        }

        body.light-theme .form-input:focus, 
        body.light-theme .form-textarea:focus, 
        body.light-theme .form-select:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: rgba(255, 255, 255, 0.8);
        }

        body.light-theme .form-input::placeholder, 
        body.light-theme .form-textarea::placeholder {
            color: rgba(0, 0, 0, 0.4);
        }

        body.light-theme .form-select option {
            background: #ffffff;
            color: #0f172a;
        }

        body.light-theme .form-label {
            color: #0f172a;
        }

        body.light-theme .card-title {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.light-theme .header h1 {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.light-theme .login-title {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.light-theme .loading-title,
        body.light-theme .loading-subtitle {
            color: #0f172a;
        }

        body.light-theme .loading-step {
            color: #475569;
        }

        body.light-theme .loading-step.active .step-status {
            color: #6366f1;
        }

        body.light-theme .loading-step.completed .step-status {
            color: #22c55e;
        }

        body.light-theme .loading-details {
            color: #64748b;
        }

        body.light-theme .activity-item {
            color: #0f172a;
        }

        body.light-theme .activity-time {
            color: rgba(0, 0, 0, 0.6);
        }

        body.light-theme .guild-item {
            color: #0f172a;
        }

        body.light-theme .guild-members {
            color: rgba(0, 0, 0, 0.6);
        }

        body.light-theme .bot-tab {
            color: #64748b;
            border-color: rgba(0, 0, 0, 0.1);
        }

        body.light-theme .bot-tab:hover {
            background: rgba(0, 0, 0, 0.03);
            border-color: rgba(0, 0, 0, 0.2);
            color: #0f172a;
        }

        body.light-theme .bot-tab.active {
            background: rgba(99, 102, 241, 0.1);
            border-color: #6366f1;
            color: #0f172a;
        }

        body.light-theme .success-message {
            background: rgba(34, 197, 94, 0.08);
            color: #059669;
            border-color: #10b981;
        }

        body.light-theme .error-message {
            background: rgba(239, 68, 68, 0.08);
            color: #dc2626;
            border-color: #ef4444;
        }

        body.light-theme .checkbox {
            accent-color: #6366f1;
        }

        body.light-theme .role-item {
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        body.light-theme .file-upload-label {
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #0f172a;
        }

        body.light-theme .file-upload:hover .file-upload-label {
            background: rgba(0, 0, 0, 0.05);
            border-color: #6366f1;
        }

        body.light-theme .avatar-placeholder {
            color: rgba(0, 0, 0, 0.4);
        }

        body.light-theme .activity-item,
        body.light-theme .guild-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        body.light-theme .form-separator {
            background: rgba(0, 0, 0, 0.08);
        }

        body.light-theme table {
            color: #0f172a;
        }

        body.light-theme th {
            color: #0f172a;
            background: rgba(99, 102, 241, 0.08) !important;
        }

        body.light-theme td {
            color: #475569;
        }

        /* These styles are now handled by the modern light theme section above */

        body.light-theme .loading-title,
        body.light-theme .loading-subtitle {
            color: #1a202c;
        }

        body.light-theme .loading-step {
            color: #4a5568;
        }

        body.light-theme .activity-item {
            color: #1a202c;
        }

        body.light-theme .guild-item {
            color: #1a202c;
        }

        body.light-theme .header h1 {
            background: linear-gradient(45deg, #7c3aed, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.light-theme .login-title {
            background: linear-gradient(45deg, #7c3aed, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Fix mobile menu text in light mode */
        body.light-theme .sidebar::before {
            background: rgba(124, 58, 237, 0.1);
            color: #7c3aed;
        }

        /* Fix any remaining white text elements */
        body.light-theme * {
            border-color: rgba(0, 0, 0, 0.1) !important;
        }

        body.light-theme .bot-tab {
            color: #4a5568;
            border-color: rgba(0, 0, 0, 0.1);
        }

        body.light-theme .bot-tab.active {
            background: #7c3aed;
            color: white;
        }

        body.light-theme .checkbox-group label {
            color: #1a202c;
        }

        body.light-theme .success-message {
            background: rgba(59, 130, 246, 0.1);
            color: #16a34a;
            border-color: #3b82f6;
        }

        body.light-theme .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border-color: #ef4444;
        }

        body.light-theme .loading-details {
            color: #6b7280;
        }

        /* Additional fixes for light mode visibility */
        body.light-theme .mobile-menu-toggle {
            color: #1a202c;
        }

        body.light-theme .file-upload-label {
            color: #4a5568;
            background: #f7fafc;
            border-color: #e2e8f0;
        }

        body.light-theme .avatar-placeholder {
            color: #718096;
        }

        body.light-theme select option {
            background: #ffffff;
            color: #1a202c;
        }

        body.light-theme .bot-section h3 {
            color: #1a202c;
        }

        body.light-theme .bot-section p {
            color: #4a5568;
        }

        body.light-theme .form-group small {
            color: #718096;
        }

        body.light-theme .activity-log {
            color: #1a202c;
        }

        body.light-theme .guild-list {
            color: #1a202c;
        }

        body.light-theme .level-roles {
            color: #1a202c;
        }

        body.light-theme .role-item input::placeholder {
            color: #a0aec0;
        }

        body.light-theme table {
            color: #1a202c;
        }

        body.light-theme th {
            color: #1a202c;
            background: rgba(124, 58, 237, 0.1) !important;
        }

        body.light-theme td {
            color: #4a5568;
        }

        /* Fix all white text elements in light mode */
        body.light-theme .toggle-btn {
            color: #4a5568 !important;
        }

        body.light-theme .toggle-btn.active {
            color: #0f172a !important;
        }

        body.light-theme .multi-select {
            color: #1a202c !important;
        }

        body.light-theme .reaction-item {
            color: #1a202c !important;
        }

        body.light-theme .clickable-avatar:hover::after {
            color: #ffffff !important;
        }

        body.light-theme .processing-spinner {
            border-color: rgba(0, 0, 0, 0.3) !important;
            border-top-color: #6366f1 !important;
        }

        body.light-theme .notification {
            color: #1a202c !important;
        }

        body.light-theme .card h3,
        body.light-theme .card h4,
        body.light-theme .card h5,
        body.light-theme .card p,
        body.light-theme .card span,
        body.light-theme .card div {
            color: #1a202c !important;
        }

        body.light-theme .card small {
            color: #64748b !important;
        }

        /* Fix menu and navigation text in light mode */
        body.light-theme .menu-item,
        body.light-theme .menu-text {
            color: #1a202c !important;
        }

        body.light-theme .notification-text {
            color: #1a202c !important;
        }

        body.light-theme .modal-content {
            color: #1a202c !important;
        }

        body.light-theme .modal-title {
            color: #1a202c !important;
        }

        body.light-theme .modal-body {
            color: #4a5568 !important;
        }

        body.light-theme .dropdown-item {
            color: #1a202c !important;
        }

        body.light-theme .tooltip {
            color: #1a202c !important;
        }

        body.light-theme .trendy-btn {
            color: #1a202c !important;
        }

        body.light-theme .trendy-btn-primary {
            color: #ffffff !important;
        }

        body.light-theme .trendy-btn-success {
            color: #ffffff !important;
        }

        body.light-theme .trendy-btn-danger {
            color: #ffffff !important;
        }

        body.light-theme .trendy-btn-warning {
            color: #1a202c !important;
        }

        /* Fix any remaining white text elements */
        body.light-theme * {
            color: #1a202c;
        }

        body.light-theme .card-title,
        body.light-theme .header h1,
        body.light-theme .nav-item.active,
        body.light-theme .nav-item.active span:not(.nav-icon),
        body.light-theme .login-title {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.light-theme .nav-item.active .nav-icon {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-separator {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
        }

        body.light-theme .form-separator {
            background: rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
        }

        /* Ensure header h1 has same gradient in both modes */
        body.light-theme .header h1,
        body.dark-theme .header h1,
        .header h1 {
            background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        .container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 280px;
            background: rgba(42, 43, 55, 0.6);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
            padding: 32px 0;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Desktop navigation arrows (hidden) */
        .mobile-nav-arrow {
            display: none;
        }
        
        .mobile-nav-container {
            display: contents;
        }
        
        .mobile-nav-slider {
            display: contents;
        }

        .sidebar.mobile-hidden {
            transform: none;
        }

        .nav-item {
            padding: 16px 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            font-weight: 500;
            border-radius: 0 16px 16px 0;
            margin: 6px 0;
            margin-right: 12px;
            color: rgba(255, 255, 255, 0.6);
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }

        .nav-item:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            border-left-color: transparent;
            transform: translateX(4px);
        }

        .nav-item:hover .nav-text {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-item:hover::before {
            left: 0%;
        }

        .nav-item:hover .nav-icon {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transform: scale(1.1);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border-left: 3px solid #6366f1;
            color: #ffffff;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
        }

        .nav-item.active .nav-icon {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-item.active .nav-text {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        /* Light mode navbar selected and hover text gradient */
        body.light-theme .nav-item.active .nav-text,
        body.light-theme .nav-item:hover .nav-text {
            background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        body.light-theme .nav-item.active .nav-icon,
        body.light-theme .nav-item:hover .nav-icon {
            background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 18px;
        }

        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(42, 43, 55, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.5), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .card:hover::before {
            opacity: 1;
        }

        .trend-card {
            background: rgba(99, 102, 241, 0.12);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(99, 102, 241, 0.25);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2);
            position: relative;
            overflow: hidden;
        }

        .trend-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #6366f1, transparent);
        }

        .trend-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(99, 102, 241, 0.3);
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(42, 43, 55, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            color: #6366f1;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }

        .stat-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #ffffff;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-select option {
            background: #1a1b23;
            color: white;
            padding: 12px 16px;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .btn-primary::before {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger::before {
            background: #dc2626;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
        }

        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-upload input[type=file] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: block;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .file-upload:hover .file-upload-label {
            background: rgba(255, 255, 255, 0.15);
            border-color: #7c3aed;
        }

        .activity-log {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .guild-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .guild-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .guild-item:last-child {
            border-bottom: none;
        }

        .guild-members {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .level-roles {
            margin-top: 20px;
        }

        .role-item {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .role-item input {
            flex: 1;
        }

        .success-message {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #3b82f6;
            color: #3b82f6;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }



        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            accent-color: #7c3aed;
        }

        /* Bot Tab Styles */
        .bot-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
        }

        .bot-tab {
            padding: 12px 20px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }

        .bot-tab:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
            color: #ffffff;
        }

        .bot-tab.active {
            background: rgba(124, 58, 237, 0.2);
            border-color: #7c3aed;
            color: #ffffff;
        }

        .bot-section {
            display: none;
        }

        .bot-section.active {
            display: block;
        }

        .range-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .range-input input {
            flex: 1;
        }

        .avatar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid #7c3aed;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-placeholder {
            color: rgba(255, 255, 255, 0.6);
            font-size: 48px;
        }
        
        .clickable-avatar {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .clickable-avatar:hover {
            transform: scale(1.05);
            border-color: #7c3aed;
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.4);
        }
        
        .clickable-avatar:hover::after {
            content: 'Click to change';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(124, 58, 237, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
        }

        .reaction-item {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .reaction-item input, .reaction-item select {
            flex: 1;
        }

        .multi-select {
            min-height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            color: white;
            resize: vertical;
        }

        /* Processing overlay */
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .processing-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #7c3aed;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toggle Buttons */
        .toggle-buttons {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .toggle-btn {
            flex: 1;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .toggle-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            transition: all 0.3s ease;
            z-index: 0;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .toggle-btn.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
            color: #6366f1;
            font-weight: 600;
        }

        /* Both toggle states use same purple color */
        .toggle-btn[id="textToggle"].active,
        .toggle-btn[id="embedToggle"].active {
            background: rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
            color: #6366f1;
        }

        .form-help {
            display: block;
            margin-top: 5px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
        }

        /* Popup notification */
        .popup-notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 400px;
            text-align: center;
        }

        .popup-notification.success {
            background: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.5);
        }

        .popup-notification.error {
            background: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.5);
        }

        .popup-notification.show {
            opacity: 1;
        }

        /* Message styles */
        .message {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .message.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-left: 4px solid #065f46;
        }

        .message.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-left: 4px solid #991b1b;
        }

        /* Light Theme Styles */
        body.light-theme {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1a202c;
        }

        body.light-theme .login-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        body.light-theme .login-box {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #1a202c;
        }

        body.light-theme .login-input {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            color: #1a202c;
        }

        body.light-theme .login-input:focus {
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        body.light-theme .login-btn {
            background: #7c3aed;
            color: white;
            font-weight: 600;
            border: none;
        }

        body.light-theme .login-btn:hover {
            background: #6b2fb5;
        }

        body.light-theme .btn-primary {
            background: #7c3aed;
            color: white;
            font-weight: 600;
            border: none;
        }

        body.light-theme .btn-primary:hover {
            background: #6b2fb5;
        }

        body.light-theme .btn-secondary {
            background: #718096;
            color: white;
            font-weight: 600;
            border: none;
        }

        body.light-theme .btn-secondary:hover {
            background: #4a5568;
        }

        body.light-theme .login-input::placeholder {
            color: rgba(0, 0, 0, 0.5);
        }

        body.light-theme .header {
            background: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.light-theme .sidebar {
            background: rgba(255, 255, 255, 0.9);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.light-theme .nav-item {
            color: rgba(0, 0, 0, 0.6);
        }

        body.light-theme .nav-item:hover {
            background: linear-gradient(45deg, rgba(124, 58, 237, 0.15), rgba(6, 182, 212, 0.15));
            border-left-color: #7c3aed;
            color: #7c3aed;
        }



        /* Old light theme styles cleaned up - using modern styles above */
        
        /* Larger text for General and AI settings tabs */
        #general-content .form-label,
        #ai-details-content .form-label {
            font-size: 22px;
            font-weight: 600;
        }
        
        #general-content .form-input,
        #general-content .form-textarea,
        #general-content .form-select,
        #ai-details-content .form-input,
        #ai-details-content .form-textarea,
        #ai-details-content .form-select {
            font-size: 18px;
            padding: 16px;
        }
        
        /* Make section titles bigger too */
        #general-content .card-title,
        #ai-details-content .card-title {
            font-size: 28px;
            font-weight: 700;
        }

        /* Trendy Modern Button Styles */
        .trendy-btn {
            position: relative;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            outline: none;
            box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .trendy-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .trendy-btn:hover::before {
            left: 100%;
        }

        .trendy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(0, 0, 0, 0.3);
        }

        .trendy-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.2);
        }

        .trendy-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .trendy-btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .trendy-btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .trendy-btn-success:hover {
            background: linear-gradient(135deg, #0e8277 0%, #2dd46b 100%);
        }

        .trendy-btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }

        .trendy-btn-danger:hover {
            background: linear-gradient(135deg, #ff5252 0%, #d63447 100%);
        }

        .trendy-btn-info {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }

        .trendy-btn-info:hover {
            background: linear-gradient(135deg, #5faef7 0%, #0770c4 100%);
        }

        .trendy-btn-warning {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
        }

        .trendy-btn-warning:hover {
            background: linear-gradient(135deg, #fbc02d 0%, #d63031 100%);
        }

        /* Small trendy buttons */
        .trendy-btn-sm {
            position: relative;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            outline: none;
            box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .trendy-btn-sm::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.4s;
        }

        .trendy-btn-sm:hover::before {
            left: 100%;
        }

        .trendy-btn-sm:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.25);
        }

        .trendy-btn-sm.trendy-btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .trendy-btn-sm.trendy-btn-warning {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: 100vh;
            }
            
            .sidebar {
                width: 100%;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 1000;
                display: flex !important;
                overflow: hidden;
                padding: 0;
                background: linear-gradient(135deg, rgba(42, 43, 55, 0.95), rgba(50, 50, 65, 0.95));
                border-top: 1px solid rgba(99, 102, 241, 0.3);
                height: 80px;
                align-items: center;
                box-shadow: 0 -2px 25px rgba(99, 102, 241, 0.3);
                transform: none !important;
                justify-content: space-between;
                backdrop-filter: blur(20px);
            }
            
            .sidebar.mobile-hidden {
                display: flex !important;
                transform: none !important;
            }
            
            body.light-theme .sidebar {
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95));
                border-top: 1px solid rgba(99, 102, 241, 0.2);
                box-shadow: 0 -2px 25px rgba(99, 102, 241, 0.15);
            }
            
            .mobile-nav-arrow {
                width: 50px;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(255, 255, 255, 0.05);
                border: none;
                color: rgba(255, 255, 255, 0.7);
                font-size: 20px;
                cursor: pointer;
                transition: all 0.3s ease;
                z-index: 1001;
                flex-shrink: 0;
            }
            
            .mobile-nav-arrow:hover {
                background: rgba(255, 255, 255, 0.1);
                color: rgba(255, 255, 255, 0.9);
            }
            
            .mobile-nav-arrow:disabled {
                opacity: 0.3;
                cursor: not-allowed;
            }
            
            body.light-theme .mobile-nav-arrow {
                background: rgba(0, 0, 0, 0.05);
                color: rgba(0, 0, 0, 0.7);
            }
            
            body.light-theme .mobile-nav-arrow:hover {
                background: rgba(0, 0, 0, 0.1);
                color: rgba(0, 0, 0, 0.9);
            }
            
            .mobile-nav-container {
                flex: 1;
                display: flex;
                overflow: hidden;
                position: relative;
            }
            
            .mobile-nav-slider {
                display: flex;
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                width: calc(100% * (8 / 3)); /* Width for 8 tabs shown 3 at a time */
                min-width: calc(100% * (8 / 3));
            }
            
            /* When database tab is shown, adjust for 4 tabs total */
            .mobile-nav-slider.with-database {
                width: calc(100% * (4 / 3)); /* Width for 4 tabs shown 3 at a time */
                min-width: calc(100% * (4 / 3));
            }
            
            .nav-item {
                flex: none;
                width: calc(100% / 8); /* Each tab takes 1/8 of total slider width */
                min-width: calc(100% / 8);
                padding: 8px 4px;
                border-left: none;
                border-bottom: none;
                border-radius: 0;
                margin: 0;
                text-align: center;
                font-size: 12px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 80px;
                transition: all 0.3s ease;
                color: rgba(255, 255, 255, 0.5);
                font-weight: 500;
                position: relative;
            }
            
            /* When database tab is shown, adjust nav-item width */
            .mobile-nav-slider.with-database .nav-item {
                width: calc(100% / 4); /* Each tab takes 1/4 of total slider width */
                min-width: calc(100% / 4);
            }
            
            /* Database tab mobile sizing */
            #databaseTab {
                width: calc(100% / 8) !important;
                min-width: calc(100% / 8) !important;
                max-width: calc(100% / 8) !important;
                background: transparent !important;
                border: none !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            /* Database tab when with-database class is active */
            .mobile-nav-slider.with-database #databaseTab {
                width: calc(100% / 4) !important;
                min-width: calc(100% / 4) !important;
                max-width: calc(100% / 4) !important;
            }
            
            #databaseTab .nav-icon {
                margin-bottom: 6px !important;
                margin-right: 0 !important;
                font-size: 24px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            #databaseTab .nav-text {
                font-size: 10px !important;
                text-align: center !important;
                display: block !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            .nav-item:hover {
                border-left: none;
                border-bottom: none;
                background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
                color: rgba(255, 255, 255, 0.9);
            }
            
            .nav-item:hover .nav-icon {
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                transform: scale(1.1);
            }
            
            .nav-item.active {
                border-left: none;
                border-bottom: none;
                background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.3));
                color: #ffffff;
            }
            
            .nav-item.active .nav-icon {
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .nav-item.active,
            .nav-item.active span:not(.nav-icon) {
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                font-weight: 600;
            }
            
            .nav-item.active::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 50%;
                transform: translateX(-50%);
                width: 40px;
                height: 4px;
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                border-radius: 2px;
                box-shadow: 0 1px 2px rgba(99, 102, 241, 0.5);
            }
            
            body.light-theme .nav-item {
                color: rgba(0, 0, 0, 0.5);
            }
            
            body.light-theme .nav-item:hover {
                background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
                color: rgba(0, 0, 0, 0.8);
            }
            



            
            .nav-icon {
                margin-right: 0;
                margin-bottom: 6px;
                font-size: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .nav-text {
                font-size: 10px;
                text-align: center;
                display: block;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .content {
                order: 1;
                padding: 15px;
                margin-bottom: 90px;
                height: calc(100vh - 170px);
                overflow-y: auto;
            }
            
            .header {
                height: auto;
                min-height: 70px;
                padding: 10px 15px;
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                text-align: left;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 18px;
                margin: 0;
                flex: 1;
            }
            
            .mobile-menu-toggle {
                display: none !important;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 15px;
            }
            
            .header {
                padding: 15px 20px;
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .role-item, .reaction-item {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            
            .role-item input, .role-item select,
            .reaction-item input, .reaction-item select {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-item {
                max-width: 70px;
                font-size: 9px;
            }
            
            .nav-icon {
                font-size: 18px;
            }
        }

        /* Loading animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Additional Mobile Styles */
        @media (max-width: 768px) {
            .login-box {
                padding: 30px 20px;
                width: 95vw;
                margin: 20px;
            }

            .login-title {
                font-size: 24px;
                margin-bottom: 20px;
            }

            .bot-tabs {
                flex-direction: column;
                gap: 10px;
            }

            .bot-tab {
                width: 100%;
                text-align: center;
                justify-content: center;
            }

            .role-item {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .activity-log {
                max-height: 250px;
            }

            .activity-item {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }

            .guild-item {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }

            .header-controls {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }

            .theme-toggle {
                width: 100%;
                padding: 10px;
            }

            .loading-box {
                width: 95vw;
                margin: 20px;
                padding: 30px 20px;
            }

            .loading-title {
                font-size: 24px;
            }

            .loading-subtitle {
                font-size: 14px;
            }

            .loading-step {
                font-size: 14px;
            }

            .checkbox-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .file-upload-label {
                padding: 16px;
                font-size: 16px;
            }

            /* Mobile-specific utility classes */
            .mobile-full-width {
                width: 100% !important;
            }

            .mobile-text-center {
                text-align: center !important;
            }

            .mobile-hide {
                display: none !important;
            }

            .mobile-show {
                display: block !important;
            }

            /* Better touch targets */
            .nav-item, .btn, .form-input, .form-select, .form-textarea {
                min-height: 44px;
            }

            /* Improved readability */
            .form-label {
                font-size: 16px;
                margin-bottom: 10px;
            }

            /* Better spacing for mobile */
            .form-group {
                margin-bottom: 25px;
            }

            .form-separator {
                margin: 25px 0;
            }
        }

        /* Tablet styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }

            .content {
                padding: 25px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }

            .form-row {
                gap: 15px;
            }
        }

        /* Mobile overlay for sidebar */
        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Better focus states for mobile */
        @media (max-width: 768px) {
            .form-input:focus, .form-textarea:focus, .form-select:focus {
                border-color: #7c3aed;
                box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
            }

            /* Mobile navigation center-fade transition */
            .nav-item:hover {
                background: linear-gradient(90deg, transparent 0%, rgba(99, 102, 241, 0.2) 50%, transparent 100%);
                background-size: 200% 100%;
                background-position: 100% 0;
                animation: centerFadeIn 0.3s ease-out forwards;
                transform: none;
                border-radius: 0;
            }

            @keyframes centerFadeIn {
                0% {
                    background-position: 100% 0;
                }
                100% {
                    background-position: 50% 0;
                }
            }
        }

        /* Make guide text blue in light mode */
        body.light-theme h4[style*="color: #3b82f6"] {
            color: #3b82f6 !important;
        }
        
        body.light-theme p[style*="color: rgba(255, 255, 255, 0.8)"] {
            color: rgba(0, 0, 0, 0.8) !important;
        }

        /* Fix text selection visibility in light mode */
        body.light-theme ::selection {
            background: rgba(99, 102, 241, 0.3);
            color: #0f172a;
        }

        body.light-theme ::-moz-selection {
            background: rgba(99, 102, 241, 0.3);
            color: #0f172a;
        }

        /* Fix toggle button text in light mode */
        body.light-theme .toggle-btn:not(.active) {
            color: rgba(0, 0, 0, 0.7) !important;
        }

        /* Fix nav styling in light mode */
        body.light-theme .nav-item.active {
            border-left: 3px solid #6366f1 !important;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3) !important;
        }
        
        /* Fix text and icon to use gradient in light mode */
        body.light-theme .nav-item.active span,
        body.light-theme .nav-item.active .nav-text,
        body.light-theme .nav-item.active .nav-icon {
            background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            color: transparent !important;
        }

        /* Improve light mode contrast */
        body.light-theme {
            background: #f8fafc !important;
        }

        body.light-theme .card {
            background: rgba(255, 255, 255, 0.95) !important;
        }

        /* Fix bot tabs styling in light mode */
        body.light-theme .bot-tab {
            background: rgba(0, 0, 0, 0.05);
            color: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.light-theme .bot-tab.active {
            background: rgba(99, 102, 241, 0.15);
            color: #6366f1;
            border-color: #6366f1;
        }

        /* Make light mode navbar match dark mode desktop */
        body.light-theme .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.light-theme .nav-item {
            color: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .nav-item:hover {
            background: rgba(99, 102, 241, 0.1);
            color: #6366f1;
        }

        /* Add more light mode contrast improvements */
        body.light-theme .form-input,
        body.light-theme .form-select,
        body.light-theme .form-textarea {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.2);
            color: #0f172a;
        }

        body.light-theme .trendy-btn {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- Login Page - Removed login requirement -->
    <div id="loginPage" class="login-container" style="display: none;">
        <div class="login-box">
            <h2 class="login-title">:v Faces Mascots Dashboard</h2>
            <input type="password" id="passwordInput" class="login-input" placeholder="Enter password" />
            <button onclick="login()" class="login-btn"><span>Login</span></button>
            <div id="loginError" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <!-- Enhanced Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">:v Faces Mascots</div>
            <div class="loading-title">Initializing Dashboard</div>
            <div class="loading-subtitle">Setting up your Discord bot control panel...</div>
            
            <div class="loading-progress">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="loading-steps">
                <div class="loading-step" id="step1">
                    <div class="step-icon"><i class="fas fa-lock"></i></div>
                    <div class="step-text">Connecting</div>
                    <div class="step-status">Waiting...</div>
                </div>
                <div class="loading-step" id="step2">
                    <div class="step-icon"><i class="fas fa-chart-bar"></i></div>
                    <div class="step-text">Loading Data</div>
                    <div class="step-status">Waiting...</div>
                </div>
                <div class="loading-step" id="step3">
                    <div class="step-icon"><i class="fas fa-magic"></i></div>
                    <div class="step-text">Preparing Interface</div>
                    <div class="step-status">Waiting...</div>
                </div>
            </div>
            
            <div class="loading-details" id="loadingDetails">
                Preparing your dashboard experience...
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="header">
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
            <h1>:v Faces Mascots Dashboard</h1>
            <div class="header-controls">
                <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
            </div>
        </div>

        <div class="mobile-overlay" onclick="toggleMobileMenu()"></div>
        
        <div class="container">
            <div class="sidebar" id="sidebar">
                <button class="mobile-nav-arrow" id="mobileNavLeft" onclick="navigateMobileNav(-1)"><i class="fas fa-chevron-left"></i></button>
                <div class="mobile-nav-container">
                    <div class="mobile-nav-slider" id="mobileNavSlider">
                        <div class="nav-item active" onclick="showTab('home')">
                            <span class="nav-icon"><i class="fas fa-home"></i></span>
                            <span class="nav-text">Home</span>
                        </div>
                        <div class="nav-item" onclick="showTab('general')">
                            <span class="nav-icon"><i class="fas fa-cog"></i></span>
                            <span class="nav-text">General</span>
                        </div>
                        <div class="nav-item" onclick="showTab('personality')">
                            <span class="nav-icon"><i class="fas fa-robot"></i></span>
                            <span class="nav-text">AI Details</span>
                        </div>
                        <div class="nav-item" onclick="showTab('levels')">
                            <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                            <span class="nav-text">Experience</span>
                        </div>
                        <div class="nav-item" onclick="showTab('reactions')">
                            <span class="nav-icon"><i class="fas fa-bolt"></i></span>
                            <span class="nav-text">Reaction</span>
                        </div>
                        <div class="nav-item" onclick="showTab('messages')">
                            <span class="nav-icon"><i class="fas fa-comments"></i></span>
                            <span class="nav-text">Messages</span>
                        </div>
                        <div class="nav-item" onclick="showTab('welcomer')">
                            <span class="nav-icon"><i class="fas fa-user-plus"></i></span>
                            <span class="nav-text">Welcomer</span>
                        </div>
                        <div class="nav-item" id="databaseTab" onclick="showTab('database')" style="display: none;">
                            <span class="nav-icon"><i class="fas fa-database"></i></span>
                            <span class="nav-text">Database</span>
                        </div>
                    </div>
                </div>
                <button class="mobile-nav-arrow" id="mobileNavRight" onclick="navigateMobileNav(1)"><i class="fas fa-chevron-right"></i></button>
            </div>

            <div class="content">
                <!-- Home Tab -->
                <div id="home" class="tab-content active">
                    <!-- Bot Status Overview -->
                    <div class="card" style="margin-bottom: 20px;">
                        <h3 class="card-title">:v Faces Mascots Status</h3>
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="bot1StatusDisplay">--</div>
                                <div class="stat-label">Bot 1 Status</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="bot2StatusDisplay">--</div>
                                <div class="stat-label">Bot 2 Status</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildCount">--</div>
                                <div class="stat-label">Connected Servers</div>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- System Performance -->
                    <div class="card">
                        <h3 class="card-title">System Performance</h3>
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="cpuUsage">--</div>
                                <div class="stat-label">CPU Usage</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="ramUsage">-- MB</div>
                                <div class="stat-label">RAM Usage</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="uptime">--</div>
                                <div class="stat-label">System Uptime</div>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- Guild Data Details -->
                    <div class="card">
                        <h3 class="card-title">Guild Data Details</h3>
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="guildName">--</div>
                                <div class="stat-label">Guild Name</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildHumanMembers">--</div>
                                <div class="stat-label">Human Members</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildBotMembers">--</div>
                                <div class="stat-label">Bot Members</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildTotalMembers">--</div>
                                <div class="stat-label">Total Members</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildPublicChannels">--</div>
                                <div class="stat-label">Public Channels</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildPrivateChannels">--</div>
                                <div class="stat-label">Private Channels</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildTotalChannels">--</div>
                                <div class="stat-label">Total Channels</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-value" id="guildRoleCount">--</div>
                                <div class="stat-label">Total Roles</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildCreatedAt">--</div>
                                <div class="stat-label">Created Date</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildVerificationLevel">--</div>
                                <div class="stat-label">Verification Level</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildBoostLevel">--</div>
                                <div class="stat-label">Boost Level</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildBoostCount">--</div>
                                <div class="stat-label">Boost Count</div>
                            </div>


                            <div class="stat-card">
                                <div class="stat-value" id="guildEmojis">--</div>
                                <div class="stat-label">Custom Emojis</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildStickers">--</div>
                                <div class="stat-label">Custom Stickers</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="guildMfaLevel">--</div>
                                <div class="stat-label">MFA Requirement</div>
                            </div>

                        </div>
                        </div>
                    </div>



                    <div class="card">
                        <h3 class="card-title">Recent Activity</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Monitor your bot's recent activities and command executions. Track system events and user interactions in real-time.
                            </p>
                        </div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <div id="activityLog" class="activity-log"></div>
                        </div>
                    </div>
                </div>

                <!-- AI Details Tab -->
                <div id="personality" class="tab-content">
                    <div class="card">
                        <h3 class="card-title">AI Details</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Configure your bot's personality traits, appearance, and behavior. This information helps the AI respond in character during conversations.
                            </p>
                        </div>
                        
                        <!-- Bot Selection Tabs -->
                        <div class="bot-tabs">
                            <button type="button" class="bot-tab active" data-bot="bot1" onclick="showBotPersonalityTab('bot1')" id="bot1PersonalityTab">Bot 1</button>
                            <button type="button" class="bot-tab" data-bot="bot2" onclick="showBotPersonalityTab('bot2')" id="bot2PersonalityTab">Bot 2</button>
                        </div>
                        
                        <div id="personalityMessage"></div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <!-- Bot 1 AI Details -->
                        <div id="bot1PersonalitySection" class="bot-section active">
                            <form id="bot1PersonalityForm">
                                <div class="form-group">
                                    <label class="form-label">Age</label>
                                    <input type="text" id="bot1Age" class="form-input" placeholder="Bot's age">
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-group">
                                    <label class="form-label">Appearance</label>
                                    <textarea id="bot1Appearance" class="form-textarea" placeholder="Describe bot's physical appearance..."></textarea>
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-group">
                                    <label class="form-label">Personality</label>
                                    <textarea id="bot1Personality" class="form-textarea" placeholder="Describe bot's overall personality..."></textarea>
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Likes</label>
                                        <textarea id="bot1Likes" class="form-textarea" placeholder="What does bot like?"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Dislikes</label>
                                        <textarea id="bot1Dislikes" class="form-textarea" placeholder="What does bot dislike?"></textarea>
                                    </div>
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-group">
                                    <label class="form-label">Backstory</label>
                                    <textarea id="bot1Backstory" class="form-textarea" placeholder="Bot's background story..."></textarea>
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-group">
                                    <label class="form-label">To Do</label>
                                    <textarea id="bot1Others" class="form-textarea" placeholder="Additional tasks or information..." style="height: 120px;"></textarea>
                                </div>
                                <button type="submit" class="trendy-btn trendy-btn-primary" id="bot1PersonalityBtn">Save Bot 1 AI Details</button>
                            </form>
                        </div>
                        
                        <!-- Bot 2 AI Details -->
                        <div id="bot2PersonalitySection" class="bot-section">
                            <form id="bot2PersonalityForm">
                                <div class="form-group">
                                    <label class="form-label">Age</label>
                                    <input type="text" id="bot2Age" class="form-input" placeholder="Bot's age">
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-group">
                                    <label class="form-label">Appearance</label>
                                    <textarea id="bot2Appearance" class="form-textarea" placeholder="Describe bot's physical appearance..."></textarea>
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-group">
                                    <label class="form-label">Personality</label>
                                    <textarea id="bot2Personality" class="form-textarea" placeholder="Describe bot's overall personality..."></textarea>
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Likes</label>
                                        <textarea id="bot2Likes" class="form-textarea" placeholder="What does bot like?"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Dislikes</label>
                                        <textarea id="bot2Dislikes" class="form-textarea" placeholder="What does bot dislike?"></textarea>
                                    </div>
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-group">
                                    <label class="form-label">Backstory</label>
                                    <textarea id="bot2Backstory" class="form-textarea" placeholder="Bot's background story..."></textarea>
                                </div>
                                <div class="form-separator"></div>
                                <div class="form-group">
                                    <label class="form-label">To Do</label>
                                    <textarea id="bot2Others" class="form-textarea" placeholder="Additional tasks or information..." style="height: 120px;"></textarea>
                                </div>
                                <button type="submit" class="trendy-btn trendy-btn-primary" id="bot2PersonalityBtn">Save Bot 2 AI Details</button>
                            </form>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- General Tab -->
                <div id="general" class="tab-content">
                    <div class="card">
                        <h3 class="card-title">General Settings</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Manage your bot's basic configuration including username, status, activity, and channel permissions. Upload custom avatars and set activity text.
                            </p>
                        </div>
                        
                        <!-- Bot Selection Tabs -->
                        <div class="bot-tabs">
                            <button type="button" class="bot-tab active" data-bot="bot1" onclick="showBotGeneralTab('bot1')" id="bot1GeneralTab">Bot 1</button>
                            <button type="button" class="bot-tab" data-bot="bot2" onclick="showBotGeneralTab('bot2')" id="bot2GeneralTab">Bot 2</button>
                        </div>
                        
                        <div id="generalMessage"></div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <!-- Bot 1 General Settings -->
                        <div id="bot1GeneralSection" class="bot-section active">
                            <form id="bot1GeneralForm">
                                <div class="avatar-container">
                                    <div class="avatar-preview clickable-avatar" id="bot1AvatarPreview" onclick="document.getElementById('bot1Avatar').click()">
                                        <div class="avatar-placeholder"><i class="fas fa-robot"></i></div>
                                    </div>
                                    <input type="file" id="bot1Avatar" name="avatar" accept="image/*" onchange="previewAvatar('bot1')" style="display: none;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Username</label>
                                    <input type="text" id="bot1Name" class="form-input" placeholder="Enter Discord username (e.g., Heilos)">
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">This is the bot's Discord username</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Bot Description</label>
                                    <textarea id="bot1Description" class="form-textarea" placeholder="Enter bot profile description..."></textarea>
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">This will be shown in the bot's Discord profile</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <select id="bot1Status" class="form-select">
                                        <option value="online">Online</option>
                                        <option value="idle">Idle</option>
                                        <option value="dnd">Do Not Disturb</option>
                                        <option value="invisible">Invisible</option>
                                        <option value="mobile">Mobile</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Activity Type</label>
                                    <select id="bot1ActivityType" class="form-select">
                                        <option value="playing">Playing</option>
                                        <option value="streaming">Streaming</option>
                                        <option value="listening">Listening to</option>
                                        <option value="watching">Watching</option>
                                        <option value="competing">Competing in</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Activity Text</label>
                                    <input type="text" id="bot1ActivityText" class="form-input" placeholder="What is the bot doing?">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Allowed Channel for Chatting & Commands</label>
                                    <select id="bot1AllowedChannels" class="form-select">
                                        <option value="">All Channels (Default)</option>
                                        <!-- Channels will be populated by JavaScript -->
                                    </select>
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">Select a specific channel or leave as default to allow all channels</small>
                                </div>
                                <button type="submit" class="trendy-btn trendy-btn-primary" id="bot1GeneralBtn">Save General Settings</button>
                            </form>
                        </div>
                        
                        <!-- Bot 2 General Settings -->
                        <div id="bot2GeneralSection" class="bot-section">
                            <form id="bot2GeneralForm">
                                <div class="avatar-container">
                                    <div class="avatar-preview clickable-avatar" id="bot2AvatarPreview" onclick="document.getElementById('bot2Avatar').click()">
                                        <div class="avatar-placeholder"><i class="fas fa-robot"></i></div>
                                    </div>
                                    <input type="file" id="bot2Avatar" name="avatar" accept="image/*" onchange="previewAvatar('bot2')" style="display: none;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Username</label>
                                    <input type="text" id="bot2Name" class="form-input" placeholder="Enter Discord username (e.g., Wisteria)">
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">This is the bot's Discord username</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Bot Description</label>
                                    <textarea id="bot2Description" class="form-textarea" placeholder="Enter bot profile description..."></textarea>
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">This will be shown in the bot's Discord profile</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <select id="bot2Status" class="form-select">
                                        <option value="online">Online</option>
                                        <option value="idle">Idle</option>
                                        <option value="dnd">Do Not Disturb</option>
                                        <option value="invisible">Invisible</option>
                                        <option value="mobile">Mobile</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Activity Type</label>
                                    <select id="bot2ActivityType" class="form-select">
                                        <option value="playing">Playing</option>
                                        <option value="streaming">Streaming</option>
                                        <option value="listening">Listening to</option>
                                        <option value="watching">Watching</option>
                                        <option value="competing">Competing in</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Activity Text</label>
                                    <input type="text" id="bot2ActivityText" class="form-input" placeholder="What is Bot 2 doing?">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Allowed Channel for Chatting & Commands</label>
                                    <select id="bot2AllowedChannels" class="form-select">
                                        <option value="">All Channels (Default)</option>
                                        <!-- Channels will be populated by JavaScript -->
                                    </select>
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">Select a specific channel or leave as default to allow all channels</small>
                                </div>
                                <button type="submit" class="trendy-btn trendy-btn-primary" id="bot2GeneralBtn">Save Bot 2 General Settings</button>
                            </form>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- Level System Tab -->
                <div id="levels" class="tab-content">
                    <!-- XP Settings Card -->
                    <div class="card">
                        <h3 class="card-title">XP Settings</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Configure how much XP users earn per message and the cooldown between XP gains. Balance progression to keep members engaged without spam.
                            </p>
                        </div>
                        
                        <div id="xpMessage"></div>
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <form id="xpForm">
                            <div class="form-group">
                                <label class="form-label">XP Range Per Message</label>
                                <div class="range-input">
                                    <input type="number" id="minXp" class="form-input" placeholder="Min XP" min="1" max="50">
                                    <span>to</span>
                                    <input type="number" id="maxXp" class="form-input" placeholder="Max XP" min="1" max="100">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">XP Cooldown (seconds)</label>
                                <input type="number" id="xpCooldown" class="form-input" placeholder="Cooldown in seconds" min="0">
                            </div>
                            <button type="submit" class="trendy-btn trendy-btn-primary">Apply XP Settings</button>
                        </form>
                        </div>

                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <form id="threadXpForm">
                            <div class="form-group">
                                <label class="form-label">Thread XP</label>
                                <input type="number" id="threadXp" class="form-input" placeholder="Thread XP" min="1" max="50">
                            </div>
                            <button type="submit" class="trendy-btn trendy-btn-primary">Apply Thread XP</button>
                        </form>
                        </div>
                    </div>

                    <!-- Level Up Announcements Card -->
                    <div class="card">
                        <h3 class="card-title">Level Up Announcements</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Enable or disable level up announcements and choose which channel they appear in. Auto-detect uses the channel where the user leveled up.
                            </p>
                        </div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <div id="announcementMessage"></div>
                        <form id="announcementForm">
                            <div class="checkbox-group">
                                <input type="checkbox" id="levelAnnouncements" class="checkbox">
                                <label for="levelAnnouncements" class="form-label">Enable Level Up Announcements</label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Level Announcement Channel</label>
                                <select id="announcementChannel" class="form-select">
                                    <option value="">Auto-detect (Default)</option>
                                    <!-- Channels will be populated by JavaScript -->
                                </select>
                            </div>
                            <button type="submit" class="trendy-btn trendy-btn-primary">Apply Announcement Settings</button>
                        </form>
                        </div>
                    </div>
                            
                    <!-- Level Role Rewards Card -->
                    <div class="card">
                        <h3 class="card-title">Level Role Rewards</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Set up role rewards that members receive when they reach specific levels. Configure what level unlocks which roles.
                            </p>
                        </div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <div id="roleRewardsMessage"></div>
                        <form id="roleRewardsForm">
                            <div class="level-roles">
                                <div id="roleRewards"></div>
                                <div style="margin-top: 10px; display: flex; gap: 10px;">
                                    <button type="button" onclick="addRoleReward()" class="trendy-btn trendy-btn-primary">Add Role Reward</button>
                                    <button type="submit" class="trendy-btn trendy-btn-primary">Apply Role Rewards</button>
                                </div>
                            </div>
                        </form>
                        </div>
                    </div>
                            

                </div>

                <!-- Reaction Tab -->
                <div id="reactions" class="tab-content">
                    <div id="reactionsMessage"></div>
                    
                    <!-- Auto React Section -->
                    <div class="card" style="margin-bottom: 30px;">
                        <h3 class="card-title">Forum Auto React</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Automatically add emoji reactions to new posts in specific forum channels. Configure which emojis each bot should add.
                            </p>
                        </div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <form id="autoReactForm">
                            <div class="checkbox-group">
                                <input type="checkbox" id="forumAutoReact" class="checkbox">
                                <label for="forumAutoReact" class="form-label">Enable Auto React in All Forums</label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Auto React in Specific Forum</label>
                                <select id="forumChannelSelect" class="form-select">
                                    <option value="">Select a forum channel</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bot 1 Emoji List for Auto React</label>
                                <input type="text" id="bot1EmojiList" class="form-input" placeholder="Enter emojis separated by commas">
                                <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">Leave empty if not needed</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bot 2 Emoji List for Auto React</label>
                                <input type="text" id="bot2EmojiList" class="form-input" placeholder="Enter emojis separated by commas">
                                <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">Leave empty if not needed</small>
                            </div>
                            <button type="submit" class="trendy-btn trendy-btn-primary" id="autoReactBtn">Apply Auto React Settings</button>
                        </form>
                        </div>
                    </div>

                    <!-- React to Message Section -->
                    <div class="card" style="margin-bottom: 30px;">
                        <h3 class="card-title">React to Specific Message</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Add specific emoji reactions to any message by providing the message ID. Useful for quickly reacting to important messages.
                            </p>
                        </div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <div id="messageReactSection">
                            <form id="messageReactForm">
                                <div class="form-group">
                                    <label class="form-label">Bot Selection</label>
                                    <select id="messageReactBot" class="form-select">
                                        <option value="bot1" id="messageReactBotOption1">Bot 1</option>
                                        <option value="bot2" id="messageReactBotOption2">Bot 2</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Message ID to React to Specific Message</label>
                                    <input type="text" id="messageReactId" class="form-input" placeholder="Enter message ID to react to (not saved)">
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">This is temporary and will not be saved to database</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Emoji List</label>
                                    <input type="text" id="messageEmojiList" class="form-input" placeholder="Enter emojis separated by commas">
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">Leave empty if not needed</small>
                                </div>
                                <button type="submit" class="trendy-btn trendy-btn-primary" id="addReactionsBtn">Add Reactions</button>
                            </form>
                        </div>
                        </div>
                    </div>

                    <!-- Advanced Reaction Roles Section -->
                    <div class="card">
                        <h3 class="card-title">Advanced Reaction Roles</h3>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Create reaction role sets with single or multiple selection modes. Configure message reactions with advanced controls.
                            </p>
                        </div>

        

                        <!-- Step 1: Create New Set -->
                        <div id="newSetCreation" class="card" style="background: rgba(124, 58, 237, 0.1); border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 20px;">
                            <h4 style="margin-bottom: 15px; color: #a855f7;">Create New Reaction Role Set</h4>
                            <div id="createSetForm">
                                <div class="form-group">
                                    <label class="form-label">Set Name</label>
                                    <input type="text" id="newSetName" class="form-input" placeholder="Enter a name for this reaction role set" required>
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">Custom name to identify this set (e.g., "Color Roles", "Game Roles")</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Message ID</label>
                                    <input type="text" id="newSetMessageId" class="form-input" placeholder="Enter the message ID to add reactions to" required>
                                    <small style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">Get this by right-clicking a message and copying the ID</small>
                                    <div id="messageValidationResult" style="margin-top: 8px; display: none;"></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Selection Mode</label>
                                    <select id="newSetMode" class="form-select" required>
                                        <option value="multiple">Multiple Selection - Users can pick multiple roles</option>
                                        <option value="single">Single Selection - Users can only pick one role (others removed)</option>
                                    </select>
                                </div>
                                <button type="button" onclick="createNewReactionSet()" class="trendy-btn trendy-btn-primary" id="createSetBtn">Create Set & Continue</button>
                            </div>
                        </div>

                        <!-- Step 2: Add Emoji/Role Pairs (Hidden initially) -->
                        <div id="emojiRoleBuilder" class="card" style="background: rgba(124, 58, 237, 0.1); border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 20px; display: none;">
                            <h4 style="margin-bottom: 15px; color: #a855f7;">Add Emoji & Role Pairs</h4>
                            <div id="currentSetInfo" style="background: rgba(59, 130, 246, 0.1); padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 14px;">
                                <!-- Set info will be populated here -->
                            </div>
                            <div id="addEmojiRoleForm">
                                <div style="display: flex; gap: 10px; margin-bottom: 15px; align-items: end;">
                                    <div class="form-group" style="flex: 1;">
                                        <label class="form-label">Emoji</label>
                                        <input type="text" id="newEmojiInput" class="form-input" placeholder="😀 or :custom_emoji:" required>
                                    </div>
                                    <div class="form-group" style="flex: 2;">
                                        <label class="form-label">Role</label>
                                        <select id="newRoleSelect" class="form-select" required>
                                            <option value="">Select a role...</option>
                                            <!-- Roles will be populated by JavaScript -->
                                        </select>
                                    </div>
                                    <div style="margin-bottom: 20px;">
                                        <button type="button" onclick="addEmojiRolePair()" class="trendy-btn trendy-btn-success">Add Pair</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Added Pairs Display -->
                            <div id="addedPairs" style="margin-bottom: 15px;">
                                <h5 style="color: #a855f7; margin-bottom: 10px;">Added Emoji/Role Pairs:</h5>
                                <div id="pairsList" style="background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 6px; min-height: 60px;">
                                    <p style="color: rgba(255, 255, 255, 0.6); font-style: italic; margin: 0;">No pairs added yet</p>
                                </div>
                            </div>

                            <!-- Final Actions -->
                            <div style="display: flex; gap: 10px; justify-content: space-between;">
                                <button type="button" onclick="cancelSetCreation()" class="trendy-btn trendy-btn-danger">Cancel</button>
                                <button type="button" onclick="event.preventDefault(); applyReactionRoleSet(); return false;" class="trendy-btn trendy-btn-primary" id="applySetBtn" disabled>Apply Reaction Role Set</button>
                            </div>
                        </div>

                        <!-- Existing Sets Management -->
                        <div class="card" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h4 style="margin-bottom: 15px; color: #3b82f6;">Existing Reaction Role Sets</h4>
                            <div id="existingSets">
                                <p style="color: rgba(255, 255, 255, 0.6); font-style: italic; margin: 0;">Loading existing reaction role sets...</p>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button type="button" onclick="refreshReactionSets()" class="trendy-btn trendy-btn-success">Refresh Sets</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Messages Tab -->
                <div id="messages" class="tab-content">
                    <!-- Send Message Section -->
                    <div class="card" style="margin-bottom: 20px;">
                        <h3 class="card-title">Send Message</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Send plain text messages as your bot to any channel. You can include files and attachments for media sharing.
                            </p>
                        </div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <div id="messagesMessage"></div>
                        <form id="sendMessageForm">
                            <div class="form-group">
                                <label class="form-label">Bot Selection</label>
                                <select id="messageBotSelection" class="form-select">
                                    <option value="bot1" id="messageBotOption1">Bot 1</option>
                                    <option value="bot2" id="messageBotOption2">Bot 2</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Channel</label>
                                <select id="messageChannel" class="form-select">
                                    <option value="">Select a channel...</option>
                                    <!-- Channels will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Message</label>
                                <textarea id="messageText" class="form-textarea" placeholder="Enter your message here..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Files (Optional)</label>
                                <input type="file" id="messageFiles" class="form-input" multiple accept="image/*,video/*,audio/*,text/*">
                            </div>
                            <button type="submit" class="trendy-btn trendy-btn-primary" id="sendMessageBtn">Send Message</button>
                        </form>
                        </div>
                    </div>
                    
                    <!-- Send Embed Section -->
                    <div class="card" style="margin-bottom: 20px;">
                        <h3 class="card-title">Send Embed</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Send rich embed messages with custom colors, titles, descriptions, and formatting. Perfect for announcements and formatted content.
                            </p>
                        </div>
                        
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <form id="sendEmbedForm">
                            <div class="form-group">
                                <label class="form-label">Bot Selection</label>
                                <select id="embedBotSelection" class="form-select">
                                    <option value="bot1" id="embedBotOption1">Bot 1</option>
                                    <option value="bot2" id="embedBotOption2">Bot 2</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Channel</label>
                                <select id="embedChannel" class="form-select">
                                    <option value="">Select a channel...</option>
                                    <!-- Channels will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Embed Title</label>
                                <input type="text" id="embedMessageTitle" class="form-input" placeholder="Embed title (optional)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Embed Description</label>
                                <textarea id="embedMessageDescription" class="form-textarea" placeholder="Embed description (optional)"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Embed Color</label>
                                <input type="color" id="embedMessageColor" class="form-input" value="#0099ff" style="width: 120px; height: 50px; padding: 5px;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Image URL</label>
                                <input type="url" id="embedImageUrl" class="form-input" placeholder="https://example.com/image.png (optional)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Thumbnail URL</label>
                                <input type="url" id="embedThumbnailUrl" class="form-input" placeholder="https://example.com/thumbnail.png (optional)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Footer Text</label>
                                <input type="text" id="embedFooterText" class="form-input" placeholder="Footer text (optional)">
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="embedTimestamp" class="checkbox">
                                <label for="embedTimestamp" class="form-label">Enable Timestamp</label>
                            </div>
                            <button type="submit" class="trendy-btn trendy-btn-primary" id="sendEmbedBtn">Send Embed</button>
                        </form>
                        </div>
                    </div>

                </div>

                <!-- Welcomer Tab -->
                <div id="welcomer" class="tab-content">
                    <!-- Welcome Messages -->
                    <div class="card">
                        <h3 class="card-title">Welcome Messages</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Set up automatic welcome messages for new server members. Choose between plain text or rich embed formats with customizable content.
                            </p>
                        </div>
                        
                        <div id="welcomerMessage"></div>
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <form id="welcomerForm">
                            <!-- Hidden field for embed toggle state -->
                            <input type="hidden" id="useEmbed" value="false">
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="welcomerEnabled" class="checkbox">
                                <label for="welcomerEnabled" class="form-label">Enable Welcome Messages</label>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Welcome Channel</label>
                                <select id="welcomeChannel" class="form-select">
                                    <option value="">Select a channel...</option>
                                    <!-- Channels will be populated by JavaScript -->
                                </select>
                                <small class="form-help">Channel where welcome messages will be sent</small>
                            </div>

                            <!-- Welcome Message Format Toggle -->
                            <div class="form-group">
                                <label class="form-label">Message Format</label>
                                <div class="toggle-buttons">
                                    <button type="button" class="toggle-btn active" id="textToggle">Plain Text</button>
                                    <button type="button" class="toggle-btn" id="embedToggle">Rich Embed</button>
                                </div>
                            </div>
                            
                            <!-- Text Message Section -->
                            <div id="textMessageSection">
                                <div class="form-group">
                                    <label class="form-label">Welcome Message</label>
                                    <textarea id="welcomeMessage" class="form-textarea" placeholder="Welcome {user} to the server! Use {user} as placeholder for user mention.">Welcome to the server, {user}!</textarea>
                                    <small class="form-help">Use {user} as placeholder for user mention</small>
                                </div>
                            </div>
                            
                            <!-- Embed Section -->
                            <div id="embedSection" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">Embed Title</label>
                                    <input type="text" id="embedTitle" class="form-input" placeholder="Welcome!" value="Welcome!">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Embed Description</label>
                                    <textarea id="embedDescription" class="form-textarea" placeholder="Welcome {user} to our awesome community!">Welcome to our server, {user}! We're glad you're here.</textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Embed Color</label>
                                    <input type="color" id="embedColor" class="form-input" value="#7c3aed" style="width: 120px; height: 50px; padding: 5px;">
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="embedThumbnail" class="checkbox" checked>
                                    <label for="embedThumbnail" class="form-label">Show User Avatar as Thumbnail</label>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Embed Footer</label>
                                    <input type="text" id="welcomeEmbedFooter" class="form-input" placeholder="Have a great time!" value="Have a great time!">
                                </div>
                            </div>
                            
                            <button type="submit" class="trendy-btn trendy-btn-primary">Save Welcome Settings</button>
                            <div class="loading-bar" id="welcomerLoading">
                                <div class="loading-bar-fill"></div>
                            </div>
                        </form>
                        </div>
                    </div>

                    <!-- Auto Role Assignment -->
                    <div class="card">
                        <h3 class="card-title">Auto Role Assignment</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Automatically assign roles to new members when they join your server. Add multiple roles that will be given immediately upon joining.
                            </p>
                        </div>
                        
                        <div id="autoRoleMessage"></div>
                        <div style="background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3); margin-bottom: 15px;">
                        <form id="autoRoleForm">
                            <div class="checkbox-group">
                                <input type="checkbox" id="autoRoleEnabled" class="checkbox">
                                <label for="autoRoleEnabled" class="form-label">Enable Auto Role Assignment</label>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Auto Roles</label>
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <h4 style="margin: 0; color: #ffffff;">Role Management</h4>
                                        <div style="display: flex; gap: 10px;">
                                            <button type="button" onclick="addAutoRole()" class="trendy-btn trendy-btn-primary" style="padding: 10px 20px; font-size: 14px;">Add Role</button>
                                            <button type="button" onclick="clearAllAutoRoles()" class="trendy-btn trendy-btn-danger" style="padding: 10px 20px; font-size: 14px;">Clear All</button>
                                        </div>
                                    </div>
                                    <div id="autoRolesList">
                                        <!-- Auto roles will be populated here -->
                                    </div>
                                </div>
                                <small class="form-help">Roles that will be automatically assigned to new members when they join the server</small>
                            </div>
                            
                            <button type="submit" class="trendy-btn trendy-btn-primary">Save Auto Role Settings</button>
                            <div class="loading-bar" id="autoRoleLoading">
                                <div class="loading-bar-fill"></div>
                            </div>
                        </form>
                        </div>
                    </div>
                </div>

                <!-- Database Tab -->
                <div id="database" class="tab-content">
                    <div class="card">
                        <h3 class="card-title">Database Management</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                            <h4 style="color: #3b82f6; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Guide</h4>
                            <p style="margin: 0; font-size: 14px; color: rgba(255, 255, 255, 0.8);">
                                Manage your bot's database tables and data. Export backups, import configurations, and view table contents for troubleshooting.
                            </p>
                        </div>
                        
                        <div id="databaseMessage"></div>
                        
                        <!-- Database Controls -->
                        <div style="margin-bottom: 30px; padding: 20px; background: rgba(124, 58, 237, 0.1); border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                            <h4 style="color: #7c3aed; margin-bottom: 15px;">Database Controls</h4>
                            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                <button onclick="autoCreateTables()" class="trendy-btn trendy-btn-success" title="Auto-Create All Database Tables">Auto-Create Tables</button>
                                <button onclick="exportDatabase()" class="trendy-btn trendy-btn-info" title="Export Database">Export Database</button>
                                <button onclick="importDatabase()" class="trendy-btn trendy-btn-info" title="Import Database">Import Database</button>
                                <button onclick="clearAllDatabase()" class="trendy-btn trendy-btn-danger" title="Clear All Database Tables">Clear All Database</button>
                            </div>
                            <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-top: 10px;">
                                Use these controls to manage your database: refresh to reload data, export to create backups, or import to restore from backup files.
                            </p>
                        </div>
                        
                        <!-- Database Overview -->
                        <div style="margin-bottom: 30px;">
                            <h4 style="color: #7c3aed; margin-bottom: 15px;">Database Tables</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Users</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Discord user data, XP, levels</p>
                                    <button onclick="viewTable('users')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Bot A (Heilos)</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Bot A configurations</p>
                                    <button onclick="viewTable('bota')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Bot B (Wisteria)</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Bot B configurations</p>
                                    <button onclick="viewTable('botb')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Others</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">System settings, XP, counting</p>
                                    <button onclick="viewTable('others')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Birthdays</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">User birthday information</p>
                                    <button onclick="viewTable('birthdays')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Level Roles</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Level-based role rewards</p>
                                    <button onclick="viewTable('level_roles')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Reaction Roles</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Emoji reaction role assignments</p>
                                    <button onclick="viewTable('reaction_roles')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Welcome Messages</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">Welcome message configurations</p>
                                    <button onclick="viewTable('welcome_messages')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>
                                <div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <h5 style="margin-bottom: 10px;">Reminders</h5>
                                    <p style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">User reminder data</p>
                                    <button onclick="viewTable('reminders')" class="trendy-btn-sm trendy-btn-primary" style="margin-top: 10px;">View Data</button>
                                </div>

                            </div>
                        </div>

                        <!-- Table Data Display -->
                        <div id="tableDataContainer" style="display: none; margin-top: 30px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 id="tableTitle" style="color: #7c3aed;">Table Data</h4>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button onclick="refreshTableData()" class="trendy-btn trendy-btn-success">Refresh</button>
                                    <button onclick="exportTableData()" class="trendy-btn trendy-btn-info">Export</button>
                                    <button onclick="hideTableData()" class="trendy-btn trendy-btn-danger">Close</button>
                                </div>
                            </div>
                            <div style="background: rgba(124, 58, 237, 0.1); padding: 10px; border-radius: 6px; margin-bottom: 10px; border: 1px solid rgba(124, 58, 237, 0.3);">
                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <span style="color: #7c3aed; font-weight: 600; font-size: 14px;">Table Actions:</span>
                                        <button onclick="addTableRecord()" class="trendy-btn-sm trendy-btn-success">Add Record</button>
                                        <button onclick="bulkDeleteRecords()" class="trendy-btn-sm trendy-btn-warning">Bulk Delete</button>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="color: rgba(255,255,255,0.7); font-size: 12px;">Search:</span>
                                        <input type="text" id="tableSearchInput" placeholder="Search records..." style="padding: 4px 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; color: white; font-size: 12px; width: 150px;" onkeyup="filterTableData()">
                                    </div>
                                </div>
                            </div>
                            <div id="tableDataContent" style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; overflow-x: auto;">
                                <!-- Table data will be displayed here -->
                            </div>
                        </div>



                        <!-- Edit Modal -->
                        <div id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a2e; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; max-height: 80%; overflow-y: auto;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <h3 id="editModalTitle" style="color: #7c3aed; margin: 0;">Edit Record</h3>
                                    <button onclick="closeEditModal()" style="background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">✕</button>
                                </div>
                                <div id="editModalContent">
                                    <!-- Edit form will be generated here -->
                                </div>
                                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: end;">
                                    <button onclick="closeEditModal()" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Cancel</button>
                                    <button onclick="saveEdit()" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div id="processingOverlay" class="processing-overlay">
        <div class="processing-spinner"></div>
    </div>

    <!-- Popup Notification -->
    <div id="popupNotification" class="popup-notification"></div>

    <script>
        let roleRewardCounter = 0;
        let reactionRoleCounter = 0;
        let guildData = null;
        let currentServerId = null;

        // Login functionality with server selection
        async function login() {
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('loginError');
            
            if (password === 'STAR' || password === 'DRONE') {
                // Hide login page and show loading screen
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('loadingScreen').style.display = 'flex';
                
                try {
                    // Step 1: Authentication & Connection
                    updateLoadingStep(1, 'active', 'Connecting...');
                    updateProgress(33);
                    updateLoadingDetails('Authenticating and connecting to Discord...');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Get actual guild IDs from the connected bot
                    const response = await fetch('/api/dashboard-stats');
                    const data = await response.json();
                    
                    if (data.success && data.stats.guilds && data.stats.guilds.length > 0) {
                        currentServerId = data.stats.guilds[0].id || '1206274128588578826';
                        updateLoadingDetails(`Connected to ${data.stats.guilds.length} servers`);
                    } else {
                        currentServerId = '1206274128588578826';
                        updateLoadingDetails('Connected with fallback configuration');
                    }
                    
                    updateLoadingStep(1, 'completed', 'Connected');
                    
                    // Step 2: Loading Data
                    updateLoadingStep(2, 'active', 'Loading data...');
                    updateProgress(66);
                    updateLoadingDetails('Loading server data and dashboard configuration...');
                    
                    // Load all data in parallel
                    await Promise.all([
                        loadGuildData(),
                        fetch('/api/bot-data').then(r => r.json())
                    ]);
                    
                    updateLoadingDetails('Server data and configuration loaded');
                    updateLoadingStep(2, 'completed', 'Loaded');
                    
                    // Step 3: Preparing Interface
                    updateLoadingStep(3, 'active', 'Preparing...');
                    updateProgress(100);
                    updateLoadingDetails('Preparing dashboard interface...');
                    
                    // Wait for all data to fully load before showing dashboard
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Pre-load all dashboard data while still showing loading screen
                    updateLoadingDetails('Loading dashboard configuration and populating fields...');
                    await loadDashboardData();
                    
                    // Wait for guild data to be fully populated
                    updateLoadingDetails('Populating dropdowns and form fields...');
                    let retryCount = 0;
                    const maxRetries = 20;
                    
                    while (retryCount < maxRetries) {
                        if (guildData && guildData.roles && guildData.roles.length > 0 && 
                            guildData.channels && guildData.channels.length > 0) {
                            break;
                        }
                        await new Promise(resolve => setTimeout(resolve, 250));
                        retryCount++;
                    }
                    
                    // Pre-populate all form fields before showing dashboard
                    await populateAllFormFields();
                    
                    // Initialize reaction roles system safely
                    setTimeout(() => {
                        try {
                            if (typeof initAdvancedReactionRoles === 'function') {
                                initAdvancedReactionRoles();
                            }
                        } catch (error) {
                            console.log('Advanced reaction roles initialization skipped:', error.message);
                        }
                    }, 100);
                    
                    updateLoadingStep(3, 'completed', 'Ready');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    addDashboardTitleClickEvent();
                    
                } catch (error) {
                    console.error('Error during login:', error);
                    // Use fallback server ID
                    currentServerId = '1206274128588578826';
                    updateLoadingDetails('Using fallback configuration...');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    loadDashboardData();
                    addDashboardTitleClickEvent();
                }
            } else {
                errorDiv.textContent = 'Invalid password';
                errorDiv.style.display = 'block';
            }
        }

        // Loading screen helper functions
        function updateLoadingStep(stepNumber, status, statusText) {
            const step = document.getElementById(`step${stepNumber}`);
            const statusElement = step.querySelector('.step-status');
            
            // Remove existing status classes
            step.classList.remove('active', 'completed');
            
            // Add new status class
            step.classList.add(status);
            
            // Update status text
            statusElement.textContent = statusText;
        }

        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
        }

        function updateLoadingDetails(text) {
            const details = document.getElementById('loadingDetails');
            details.textContent = text;
        }

        // Processing overlay functions
        function showProcessing() {
            const overlay = document.getElementById('processingOverlay');
            overlay.style.display = 'flex';
            // Disable all buttons and forms during processing
            document.querySelectorAll('button, input[type="submit"]').forEach(element => {
                element.disabled = true;
            });
            overlay.style.pointerEvents = 'auto';
        }

        function hideProcessing() {
            const overlay = document.getElementById('processingOverlay');
            overlay.style.display = 'none';
            // Re-enable all buttons and forms
            document.querySelectorAll('button, input[type="submit"]').forEach(element => {
                element.disabled = false;
            });
        }

        // Popup notification function with auto-dismiss after 8 seconds
        function showPopupNotification(message, success = true) {
            const popup = document.getElementById('popupNotification');
            popup.textContent = message;
            popup.className = `popup-notification ${success ? 'success' : 'error'}`;
            popup.classList.add('show');
            
            // Auto-fade after 3 seconds
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        // Avatar preview function
        function previewAvatar(botId) {
            const file = document.getElementById(`${botId}Avatar`).files[0];
            const preview = document.getElementById(`${botId}AvatarPreview`);
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="${botId} Avatar Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // Message display function
        function showMessage(elementId, message, success = true) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = success ? 'message success' : 'message error';
                element.style.display = 'block';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 8000);
            }
        }





        // Mobile navigation state
        let currentMobileIndex = 0;
        const navItems = [];
        
        // Initialize mobile navigation
        function initMobileNavigation() {
            // Get all nav items
            const allNavItems = document.querySelectorAll('.nav-item');
            navItems.length = 0;
            allNavItems.forEach(item => {
                if (item.style.display !== 'none') {
                    navItems.push(item);
                }
            });
            
            // Check if database tab is visible
            const databaseTab = document.getElementById('databaseTab');
            const isDatabaseVisible = databaseTab && databaseTab.style.display !== 'none';
            
            // Update slider class based on database tab visibility
            const slider = document.getElementById('mobileNavSlider');
            if (slider) {
                if (isDatabaseVisible) {
                    slider.classList.add('with-database');
                } else {
                    slider.classList.remove('with-database');
                }
            }
            
            // Set initial position to show first 3 items with middle selected
            currentMobileIndex = 0;
            updateMobileNavigation();
        }
        
        // Update mobile navigation display
        function updateMobileNavigation() {
            if (window.innerWidth <= 768) {
                const slider = document.getElementById('mobileNavSlider');
                const leftArrow = document.getElementById('mobileNavLeft');
                const rightArrow = document.getElementById('mobileNavRight');
                
                if (slider && leftArrow && rightArrow) {
                    // Check if database tab is visible
                    const isDatabaseVisible = slider.classList.contains('with-database');
                    
                    // Calculate item width based on total number of tabs
                    const itemWidth = isDatabaseVisible ? 100 / 4 : 100 / 8; // 4 tabs or 8 tabs
                    const translateX = -currentMobileIndex * itemWidth;
                    slider.style.transform = `translateX(${translateX}%)`;
                    
                    // Update arrow states with proper bounds checking
                    if (leftArrow) {
                        leftArrow.disabled = currentMobileIndex === 0;
                    }
                    if (rightArrow) {
                        rightArrow.disabled = currentMobileIndex >= Math.max(0, navItems.length - 3);
                    }
                    
                    // Highlight middle item as active if not manually selected
                    const middleIndex = currentMobileIndex + 1;
                    if (middleIndex < navItems.length && navItems[middleIndex]) {
                        // Only auto-select if no item is manually active
                        const hasActiveItem = navItems.some(item => item && item.classList && item.classList.contains('active'));
                        if (!hasActiveItem) {
                            navItems[middleIndex].classList.add('active');
                        }
                    }
                }
            }
        }
        
        // Navigate mobile tabs
        function navigateMobileNav(direction) {
            // Ensure we have nav items initialized
            if (navItems.length === 0) {
                initMobileNavigation();
                return;
            }
            
            // Find current active tab
            const activeTab = document.querySelector('.nav-item.active');
            if (!activeTab) {
                // If no active tab, activate the first one
                if (navItems[0]) {
                    navItems[0].classList.add('active');
                    const onclickAttr = navItems[0].getAttribute('onclick');
                    if (onclickAttr) {
                        const tabMatch = onclickAttr.match(/showTab\(['"]([^'"]+)['"]\)/);
                        if (tabMatch) {
                            showTab(tabMatch[1]);
                        }
                    }
                }
                return;
            }
            
            const activeIndex = navItems.findIndex(item => item === activeTab);
            
            if (activeIndex !== -1) {
                // Calculate new index with proper bounds checking
                const newIndex = activeIndex + direction;
                
                // Check bounds more carefully
                if (newIndex >= 0 && newIndex < navItems.length && navItems[newIndex]) {
                    // Remove active from current
                    activeTab.classList.remove('active');
                    
                    // Add active to new tab
                    navItems[newIndex].classList.add('active');
                    
                    // Get the tab name from onclick attribute and trigger navigation
                    const onclickAttr = navItems[newIndex].getAttribute('onclick');
                    if (onclickAttr) {
                        const tabMatch = onclickAttr.match(/showTab\(['"]([^'"]+)['"]\)/);
                        if (tabMatch) {
                            showTab(tabMatch[1]);
                        }
                    }
                    
                    // Update mobile navigation to center the selected item
                    currentMobileIndex = Math.max(0, Math.min(newIndex - 1, navItems.length - 3));
                    updateMobileNavigation();
                }
            }
        }
        
        // Tab navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            
            // Show selected tab
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Find and activate the corresponding nav item
            let targetNavItem = null;
            if (event && event.target) {
                targetNavItem = event.target.closest('.nav-item');
            } else {
                // Find nav item by tab name if no event (for programmatic calls)
                targetNavItem = document.querySelector(`.nav-item[onclick*="${tabName}"]`);
            }
            
            if (targetNavItem) {
                targetNavItem.classList.add('active');
                
                // On mobile, center the active tab
                if (window.innerWidth <= 768 && navItems.length > 0) {
                    const activeIndex = navItems.indexOf(targetNavItem);
                    if (activeIndex >= 0) {
                        // Center the active item in the 3-tab view
                        // For centering, we want the selected tab to appear in the middle position
                        // So if we select index 2, we want to show tabs 1,2,3 (currentMobileIndex = 1)
                        currentMobileIndex = Math.max(0, Math.min(activeIndex - 1, navItems.length - 3));
                        updateMobileNavigation();
                    }
                }
            }
            
            // Close mobile sidebar if open
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.querySelector('.mobile-overlay');
                if (sidebar) sidebar.classList.remove('mobile-open');
                if (overlay) overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
            
            // Initialize advanced reaction roles when reactions tab is opened
            if (tabName === 'reactions') {
                // Delay initialization to ensure DOM is ready
                setTimeout(initAdvancedReactionRoles, 100);
            }
        }
        
        // Initialize mobile navigation on page load and resize
        window.addEventListener('load', initMobileNavigation);
        window.addEventListener('resize', () => {
            setTimeout(initMobileNavigation, 100);
        });

        // Bot tab navigation for General settings
        function showBotGeneralTab(botId) {
            // Remove active from all bot tabs in General section
            document.querySelectorAll('#general .bot-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hide all bot sections in General
            document.querySelectorAll('#general .bot-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected bot tab and section
            document.querySelector(`#general .bot-tab[data-bot="${botId}"]`).classList.add('active');
            document.getElementById(`${botId}GeneralSection`).classList.add('active');
        }

        // Bot tab navigation for AI Details
        function showBotPersonalityTab(botId) {
            // Remove active from all bot tabs in AI Details section
            document.querySelectorAll('#personality .bot-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hide all bot sections in AI Details
            document.querySelectorAll('#personality .bot-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected bot tab and section
            document.querySelector(`#personality .bot-tab[data-bot="${botId}"]`).classList.add('active');
            document.getElementById(`${botId}PersonalitySection`).classList.add('active');
        }

        // Populate all form fields and dropdowns
        async function populateAllFormFields() {
            try {
                // Ensure guild data is available
                if (!guildData || !guildData.roles || !guildData.channels) {
                    console.log('Guild data not ready for field population');
                    return;
                }

                // Populate channel dropdowns
                const channelSelects = document.querySelectorAll('select[id*="Channel"], select[id*="channel"]');
                channelSelects.forEach(select => {
                    if (select && select.options.length <= 1) { // Only populate if empty
                        // Clear existing options
                        select.innerHTML = '<option value="">Select Channel</option>';
                        
                        // Add channels based on select type
                        if (select.id === 'forumChannelSelect') {
                            // Only add forum channels for forum select
                            guildData.channels.filter(channel => channel.type === 'forum').forEach(channel => {
                                const option = document.createElement('option');
                                option.value = channel.id;
                                option.textContent = `${channel.icon} ${channel.name}`;
                                select.appendChild(option);
                            });
                        } else {
                            // Add all channels for other selects
                            guildData.channels.forEach(channel => {
                                const option = document.createElement('option');
                                option.value = channel.id;
                                option.textContent = `${channel.icon} ${channel.name}`;
                                select.appendChild(option);
                            });
                        }
                    }
                });

                // Populate role dropdowns
                const roleSelects = document.querySelectorAll('select[id*="Role"], select[id*="role"]');
                roleSelects.forEach(select => {
                    if (select && select.options.length <= 1) { // Only populate if empty
                        // Clear existing options
                        select.innerHTML = '<option value="">Select Role</option>';
                        
                        // Add roles
                        guildData.roles.forEach(role => {
                            const option = document.createElement('option');
                            option.value = role.id;
                            option.textContent = role.name;
                            select.appendChild(option);
                        });
                    }
                });

                // Populate auto role dropdown specifically
                const autoRoleSelect = document.getElementById('autoRole');
                if (autoRoleSelect && autoRoleSelect.options.length <= 1) {
                    autoRoleSelect.innerHTML = '<option value="">Select Auto Role</option>';
                    guildData.roles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role.id;
                        option.textContent = role.name;
                        autoRoleSelect.appendChild(option);
                    });
                }


                
            } catch (error) {
                console.error('Error populating form fields:', error);
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load guild data first for dropdowns (blocking)
                await loadGuildData();
                
                // Load bot data
                const response = await fetch('/api/bot-data');
                const data = await response.json();
                
                if (data && data.success && data.data) {
                    // Bot 1 AI Details (with null checks)
                    const bot1Data = data.data.bot1 || {};
                    const bot1DisplayName = bot1Data.displayName || bot1Data.name || 'AI Assistant';
                    
                    const bot1Elements = [
                        { id: 'bot1Age', value: bot1Data.age || '', placeholder: `${bot1DisplayName}'s age` },
                        { id: 'bot1Appearance', value: bot1Data.appearance || '', placeholder: `Describe ${bot1DisplayName}'s physical appearance...` },
                        { id: 'bot1Personality', value: bot1Data.personality || '', placeholder: `Describe ${bot1DisplayName}'s overall personality...` },
                        { id: 'bot1Likes', value: bot1Data.likes || '', placeholder: `What does ${bot1DisplayName} like?` },
                        { id: 'bot1Dislikes', value: bot1Data.dislikes || '', placeholder: `What does ${bot1DisplayName} dislike?` },
                        { id: 'bot1Backstory', value: bot1Data.backstory || '', placeholder: `${bot1DisplayName}'s background story...` },
                        { id: 'bot1Others', value: bot1Data.others || '', placeholder: `Additional tasks or information for ${bot1DisplayName}...` }
                    ];
                    
                    bot1Elements.forEach(elem => {
                        const element = document.getElementById(elem.id);
                        if (element && elem.value !== null && elem.value !== undefined) {
                            try {
                                element.value = String(elem.value);
                                if (elem.placeholder) {
                                    element.placeholder = String(elem.placeholder);
                                }
                            } catch (error) {
                                console.log(`Error setting value for ${elem.id}:`, error.message);
                            }
                        }
                    });
                    
                    // Bot 2 AI Details (with null checks)
                    const bot2Data = data.data.bot2 || {};
                    const bot2DisplayName = bot2Data.displayName || bot2Data.name || 'AI Assistant 2';
                    
                    const bot2Elements = [
                        { id: 'bot2Age', value: bot2Data.age || '', placeholder: `${bot2DisplayName}'s age` },
                        { id: 'bot2Appearance', value: bot2Data.appearance || '', placeholder: `Describe ${bot2DisplayName}'s physical appearance...` },
                        { id: 'bot2Personality', value: bot2Data.personality || '', placeholder: `Describe ${bot2DisplayName}'s overall personality...` },
                        { id: 'bot2Likes', value: bot2Data.likes || '', placeholder: `What does ${bot2DisplayName} like?` },
                        { id: 'bot2Dislikes', value: bot2Data.dislikes || '', placeholder: `What does ${bot2DisplayName} dislike?` },
                        { id: 'bot2Backstory', value: bot2Data.backstory || '', placeholder: `${bot2DisplayName}'s background story...` },
                        { id: 'bot2Others', value: bot2Data.others || '', placeholder: `Additional tasks or information for ${bot2DisplayName}...` }
                    ];
                    
                    bot2Elements.forEach(elem => {
                        const element = document.getElementById(elem.id);
                        if (element && elem.value !== null && elem.value !== undefined) {
                            try {
                                element.value = String(elem.value);
                                if (elem.placeholder) {
                                    element.placeholder = String(elem.placeholder);
                                }
                            } catch (error) {
                                console.log(`Error setting value for ${elem.id}:`, error.message);
                            }
                        }
                    });
                    
                    // Bot 1 General Settings (with null checks)
                    const bot1GeneralElements = [
                        { id: 'bot1Name', value: bot1Data.name || '' },
                        { id: 'bot1Description', value: bot1Data.description || '' },
                        { id: 'bot1Status', value: bot1Data.status || 'online' },
                        { id: 'bot1ActivityType', value: bot1Data.activityType || 'playing' },
                        { id: 'bot1ActivityText', value: bot1Data.activityText || '' }
                    ];
                    
                    bot1GeneralElements.forEach(elem => {
                        const element = document.getElementById(elem.id);
                        if (element && elem.value !== null && elem.value !== undefined) {
                            try {
                                element.value = String(elem.value);
                            } catch (error) {
                                console.log(`Error setting value for ${elem.id}:`, error.message);
                            }
                        }
                    });
                    
                    // Bot 2 General Settings (with null checks)
                    const bot2GeneralElements = [
                        { id: 'bot2Name', value: bot2Data.name || '' },
                        { id: 'bot2Description', value: bot2Data.description || '' },
                        { id: 'bot2Status', value: bot2Data.status || 'online' },
                        { id: 'bot2ActivityType', value: bot2Data.activityType || 'playing' },
                        { id: 'bot2ActivityText', value: bot2Data.activityText || '' }
                    ];
                    
                    bot2GeneralElements.forEach(elem => {
                        const element = document.getElementById(elem.id);
                        if (element && elem.value !== null && elem.value !== undefined) {
                            try {
                                element.value = String(elem.value);
                            } catch (error) {
                                console.log(`Error setting value for ${elem.id}:`, error.message);
                            }
                        }
                    });
                    
                    // Load allowed channels for both bots (text field now)
                    populateChannelDropdowns();
                    if (bot1Data.allowedChannels) {
                        const bot1ChannelsEl = document.getElementById('bot1AllowedChannels');
                        if (bot1ChannelsEl && bot1Data.allowedChannels !== null && bot1Data.allowedChannels !== undefined) {
                            try {
                                bot1ChannelsEl.value = String(bot1Data.allowedChannels);
                            } catch (error) {
                                console.log('Error setting bot1 allowed channels:', error.message);
                            }
                        }
                    }
                    if (bot2Data.allowedChannels) {
                        const bot2ChannelsEl = document.getElementById('bot2AllowedChannels');
                        if (bot2ChannelsEl && bot2Data.allowedChannels !== null && bot2Data.allowedChannels !== undefined) {
                            try {
                                bot2ChannelsEl.value = String(bot2Data.allowedChannels);
                            } catch (error) {
                                console.log('Error setting bot2 allowed channels:', error.message);
                            }
                        }
                    }
                    
                    // Level Settings (shared) with null checks
                    const xpSettings = data.data.xpSettings || {};
                    const xpElements = [
                        { id: 'minXp', value: xpSettings.minXp || 1 },
                        { id: 'maxXp', value: xpSettings.maxXp || 15 },
                        { id: 'xpCooldown', value: Math.floor((xpSettings.xpCooldown || 60000) / 1000) },
                        { id: 'announcementChannel', value: xpSettings.announcementChannel || '' },
                        { id: 'threadXp', value: xpSettings.threadXp || 0 }
                    ];
                    
                    xpElements.forEach(elem => {
                        const element = document.getElementById(elem.id);
                        if (element && elem.value !== null && elem.value !== undefined) {
                            try {
                                element.value = String(elem.value);
                            } catch (error) {
                                console.log(`Error setting value for ${elem.id}:`, error.message);
                            }
                        }
                    });
                    
                    const levelAnnouncementsEl = document.getElementById('levelAnnouncements');
                    if (levelAnnouncementsEl) levelAnnouncementsEl.checked = xpSettings.levelUpAnnouncement !== false;
                    
                    // Guild data is already loaded, now load role rewards, reaction roles, welcomer settings
                    loadRoleRewards(data.data.levelRoles || []);
                    loadReactionRoles(data.data.reactionRoles || []);
                    loadWelcomerSettings(data.data);
                    loadNewWelcomerSettings(data.data.welcomer || {});
                    loadAutoRoleSettings(data.data.autoRoleSettings || {});
                    // Load forum auto-react settings using the API data
                    if (data.data.forumAutoReact) {
                        // Load checkbox
                        const forumAutoReactEl = document.getElementById('forumAutoReact');
                        if (forumAutoReactEl) {
                            forumAutoReactEl.checked = data.data.forumAutoReact.enabled || false;
                        }
                        
                        // Load selected forum
                        const forumChannelSelectEl = document.getElementById('forumChannelSelect');
                        if (forumChannelSelectEl && data.data.forumAutoReact.selectedForum !== null && data.data.forumAutoReact.selectedForum !== undefined) {
                            try {
                                forumChannelSelectEl.value = String(data.data.forumAutoReact.selectedForum);
                            } catch (error) {
                                console.log('Error setting forum channel select:', error.message);
                            }
                        }
                        
                        // Load bot emoji lists
                        const bot1EmojiEl = document.getElementById('bot1EmojiList');
                        const bot2EmojiEl = document.getElementById('bot2EmojiList');
                        if (bot1EmojiEl && data.data.forumAutoReact.bot1EmojiList !== null && data.data.forumAutoReact.bot1EmojiList !== undefined) {
                            try {
                                bot1EmojiEl.value = String(data.data.forumAutoReact.bot1EmojiList || '');
                            } catch (error) {
                                console.log('Error setting bot1 emoji list:', error.message);
                            }
                        }
                        if (bot2EmojiEl && data.data.forumAutoReact.bot2EmojiList !== null && data.data.forumAutoReact.bot2EmojiList !== undefined) {
                            try {
                                bot2EmojiEl.value = String(data.data.forumAutoReact.bot2EmojiList || '');
                            } catch (error) {
                                console.log('Error setting bot2 emoji list:', error.message);
                            }
                        }
                    }
                    
                    // Update tab labels with bot names (with null checks)
                    if (bot1Data.name) {
                        const bot1GeneralTabEl = document.getElementById('bot1GeneralTab');
                        const bot1PersonalityTabEl = document.getElementById('bot1PersonalityTab');
                        if (bot1GeneralTabEl) bot1GeneralTabEl.textContent = bot1Data.name;
                        if (bot1PersonalityTabEl) bot1PersonalityTabEl.textContent = bot1Data.name;
                    }
                    if (bot2Data.name) {
                        const bot2GeneralTabEl = document.getElementById('bot2GeneralTab');
                        const bot2PersonalityTabEl = document.getElementById('bot2PersonalityTab');
                        if (bot2GeneralTabEl) bot2GeneralTabEl.textContent = bot2Data.name;
                        if (bot2PersonalityTabEl) bot2PersonalityTabEl.textContent = bot2Data.name;
                    }
                }
                
                // Load dashboard stats
                loadDashboardStats();
                
                // Set up periodic updates (only once)
                if (!window.statsInterval) {
                    window.statsInterval = setInterval(loadDashboardStats, 30000); // Reduced from 5s to 30s
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                console.error('Error details:', error.message, error.stack);
            }
        }

        // Load guild data for dropdowns
        async function loadGuildData() {
            try {
                const response = await fetch(`/api/guild-data?serverId=${currentServerId}`);
                const data = await response.json();
                
                if (data.success) {
                    guildData = data.data;
                    // Repopulate auto role dropdowns with loaded guild data
                    repopulateAutoRoleDropdowns();
                    // Don't initialize advanced reaction roles immediately to avoid errors
                    // It will be initialized when user navigates to reactions tab
                }
            } catch (error) {
                console.error('Error loading guild data:', error);
                console.error('Guild data error details:', error.message, error.stack);
            }
        }

        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/dashboard-stats');
                const data = await response.json();
                
                if (data.success) {
                    // Helper function to safely update element text content
                    const safeUpdateElement = (id, content) => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.textContent = content;
                        }
                    };
                    
                    safeUpdateElement('cpuUsage', data.stats.cpu + '%');
                    safeUpdateElement('ramUsage', data.stats.ram + ' MB');
                    safeUpdateElement('uptime', data.stats.uptime);
                    safeUpdateElement('guildCount', data.stats.guildCount);
                    safeUpdateElement('totalUsers', data.stats.totalUsers || '--');
                    
                    // Update bot statuses
                    safeUpdateElement('bot1StatusDisplay', data.stats.bot1Status || '🔴 Offline');
                    safeUpdateElement('bot2StatusDisplay', data.stats.bot2Status || '🔴 Offline');
                    
                    // Update guild data details
                    if (data.targetGuildId && data.stats.guilds.length > 0) {
                        const targetGuild = data.stats.guilds.find(g => g.id === data.targetGuildId) || data.stats.guilds[0];
                        safeUpdateElement('guildName', targetGuild.name || '--');
                        safeUpdateElement('guildTotalMembers', targetGuild.memberCount || 'Loading...');
                        safeUpdateElement('guildHumanMembers', targetGuild.humanCount || 'Loading...');
                        safeUpdateElement('guildBotMembers', targetGuild.botCount || 'Loading...');
                        safeUpdateElement('guildPublicChannels', targetGuild.publicChannels || 'Loading...');
                        safeUpdateElement('guildPrivateChannels', targetGuild.privateChannels || 'Loading...');
                        safeUpdateElement('guildTotalChannels', targetGuild.totalChannels || 'Loading...');
                        safeUpdateElement('guildRoleCount', targetGuild.roleCount || 'Loading...');
                        safeUpdateElement('guildCreatedAt', targetGuild.createdAt || 'Loading...');
                        safeUpdateElement('guildVerificationLevel', targetGuild.verificationLevel || 'Loading...');
                        safeUpdateElement('guildBoostLevel', targetGuild.boostLevel || 'Loading...');
                        safeUpdateElement('guildBoostCount', targetGuild.boostCount || 'Loading...');

                        safeUpdateElement('guildOwner', targetGuild.owner || 'Loading...');
                        safeUpdateElement('guildDescription', targetGuild.description || 'Loading...');
                        safeUpdateElement('guildFeatures', targetGuild.features || 'Loading...');
                        safeUpdateElement('guildEmojis', targetGuild.emojis || 'Loading...');
                        safeUpdateElement('guildStickers', targetGuild.stickers || 'Loading...');
                        safeUpdateElement('guildMfaLevel', targetGuild.mfaLevel || 'Loading...');
                        safeUpdateElement('guildNsfwLevel', targetGuild.nsfwLevel || 'Loading...');
                        safeUpdateElement('guildMaxMembers', targetGuild.maxMembers || 'Loading...');
                        safeUpdateElement('guildVanityUrl', targetGuild.vanityUrl || 'Loading...');
                        safeUpdateElement('guildBanner', targetGuild.banner || 'Loading...');
                    } else {
                        safeUpdateElement('guildName', '--');
                        safeUpdateElement('guildTotalMembers', 'Loading...');
                        safeUpdateElement('guildHumanMembers', 'Loading...');
                        safeUpdateElement('guildBotMembers', 'Loading...');
                        safeUpdateElement('guildPublicChannels', 'Loading...');
                        safeUpdateElement('guildPrivateChannels', 'Loading...');
                        safeUpdateElement('guildTotalChannels', 'Loading...');
                        safeUpdateElement('guildRoleCount', 'Loading...');
                        safeUpdateElement('guildCreatedAt', 'Loading...');
                        safeUpdateElement('guildVerificationLevel', 'Loading...');
                        safeUpdateElement('guildBoostLevel', 'Loading...');
                        safeUpdateElement('guildBoostCount', 'Loading...');

                        safeUpdateElement('guildOwner', 'Loading...');
                        safeUpdateElement('guildDescription', 'Loading...');
                        safeUpdateElement('guildFeatures', 'Loading...');
                        safeUpdateElement('guildEmojis', 'Loading...');
                        safeUpdateElement('guildStickers', 'Loading...');
                        safeUpdateElement('guildMfaLevel', 'Loading...');
                        safeUpdateElement('guildNsfwLevel', 'Loading...');
                        safeUpdateElement('guildMaxMembers', 'Loading...');
                        safeUpdateElement('guildVanityUrl', 'Loading...');
                        safeUpdateElement('guildBanner', 'Loading...');
                    }

                    
                    // Update bot names in tabs and dropdowns if available
                    if (data.stats.bot1Name) {
                        document.querySelectorAll('[data-bot="bot1"]').forEach(tab => {
                            tab.textContent = data.stats.bot1Name;
                        });
                        // Update dropdown options
                        const bot1Options = document.querySelectorAll('#messageBotOption1, #embedBotOption1, #messageReactBotOption1');
                        bot1Options.forEach(option => {
                            option.textContent = data.stats.bot1Name;
                        });
                        // Update button texts
                        const bot1PersonalityBtn = document.getElementById('bot1PersonalityBtn');
                        const bot1GeneralBtn = document.getElementById('bot1GeneralBtn');
                        if (bot1PersonalityBtn) bot1PersonalityBtn.textContent = `Save ${data.stats.bot1Name} AI Details`;
                        if (bot1GeneralBtn) bot1GeneralBtn.textContent = `Save ${data.stats.bot1Name} General Settings`;
                    }
                    if (data.stats.bot2Name) {
                        document.querySelectorAll('[data-bot="bot2"]').forEach(tab => {
                            tab.textContent = data.stats.bot2Name;
                        });
                        // Update dropdown options
                        const bot2Options = document.querySelectorAll('#messageBotOption2, #embedBotOption2, #messageReactBotOption2');
                        bot2Options.forEach(option => {
                            option.textContent = data.stats.bot2Name;
                        });
                        // Update button texts
                        const bot2PersonalityBtn = document.getElementById('bot2PersonalityBtn');
                        const bot2GeneralBtn = document.getElementById('bot2GeneralBtn');
                        if (bot2PersonalityBtn) bot2PersonalityBtn.textContent = `Save ${data.stats.bot2Name} AI Details`;
                        if (bot2GeneralBtn) bot2GeneralBtn.textContent = `Save ${data.stats.bot2Name} General Settings`;
                    }
                    
                    // Update guild list
                    const guildList = document.getElementById('guildList');
                    if (guildList) {
                        guildList.innerHTML = '';
                        data.stats.guilds.forEach(guild => {
                            const guildItem = document.createElement('div');
                            guildItem.className = 'guild-item';
                            guildItem.innerHTML = `
                                <span>${guild.name}</span>
                                <span class="guild-members">${guild.memberCount} members</span>
                            `;
                            guildList.appendChild(guildItem);
                        });
                    }
                    
                    // Update activity log
                    const activityLog = document.getElementById('activityLog');
                    if (activityLog) {
                        activityLog.innerHTML = '';
                        data.stats.recentActivity.forEach(activity => {
                            const activityItem = document.createElement('div');
                            activityItem.className = 'activity-item';
                            activityItem.innerHTML = `
                                <span>${activity.message}</span>
                                <span class="activity-time">${activity.time}</span>
                            `;
                            activityLog.appendChild(activityItem);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        // Load role rewards
        function loadRoleRewards(roleRewards) {
            const container = document.getElementById('roleRewards');
            container.innerHTML = '';
            roleRewardCounter = 0;
            
            roleRewards.forEach(reward => {
                addRoleReward(reward.level, reward.role_id || reward.roleId);
            });
            
            if (roleRewards.length === 0) {
                addRoleReward();
            }
        }

        // Add role reward
        function addRoleReward(level = '', roleId = '') {
            const container = document.getElementById('roleRewards');
            const roleItem = document.createElement('div');
            roleItem.className = 'role-item';
            roleItem.id = `role-${roleRewardCounter}`;
            
            let rolesOptions = '<option value="">Select a role...</option>';
            if (guildData && guildData.roles) {
                guildData.roles.forEach(role => {
                    const selected = role.id === roleId ? 'selected' : '';
                    rolesOptions += `<option value="${role.id}" ${selected}>@${role.name}</option>`;
                });
            }
            
            roleItem.innerHTML = `
                <input type="number" placeholder="Level" value="${level}" min="1" class="form-input" style="width: 100px;">
                <select class="form-select" style="flex: 1;">
                    ${rolesOptions}
                </select>
                <button type="button" onclick="removeRoleReward('role-${roleRewardCounter}')" class="trendy-btn trendy-btn-danger" style="padding: 8px 15px; font-size: 12px; border-radius: 6px;">Remove</button>
            `;
            
            container.appendChild(roleItem);
            roleRewardCounter++;
        }

        // Remove role reward
        function removeRoleReward(id) {
            document.getElementById(id).remove();
        }

        // Populate channel dropdowns
        function populateChannelDropdowns(selectedChannels = []) {
            const allowedChannelsSelect = document.getElementById('allowedChannels');
            const announcementChannelSelect = document.getElementById('announcementChannel');
            
            if (guildData && guildData.channels) {
                // Clear existing options
                allowedChannelsSelect.innerHTML = '';
                
                guildData.channels.forEach(channel => {
                    // Include text, voice, stage, and announcement channels (exclude forum)
                    if (channel.type !== 15) { // Exclude forum channels
                        const option = document.createElement('option');
                        option.value = channel.id;
                        
                        // Add appropriate prefix based on channel type
                        let prefix = '#';
                        if (channel.type === 2) prefix = '🔊'; // Voice channels
                        else if (channel.type === 13) prefix = '🎤'; // Stage channels
                        else if (channel.type === 5) prefix = '📢'; // Announcement channels
                        
                        option.textContent = `${prefix}${channel.name}`;
                        if (selectedChannels.includes(channel.id)) {
                            option.selected = true;
                        }
                        allowedChannelsSelect.appendChild(option);
                    }
                });
            }
        }

        // Advanced Reaction Roles functions
        let currentReactionSet = {
            messageId: '',
            setMode: 'multiple',
            pairs: []
        };

        // Initialize advanced reaction roles system
        function initAdvancedReactionRoles() {
            try {
                // Check if we're in the reactions tab
                const reactionsTab = document.getElementById('reactions');
                if (!reactionsTab || !reactionsTab.classList.contains('active')) {
                    // Not in reactions tab, skip initialization
                    return;
                }
                
                // Check if advanced reaction roles elements exist
                const newRoleSelect = document.getElementById('newRoleSelect');
                const existingSets = document.getElementById('existingSets');
                
                if (!newRoleSelect || !existingSets) {
                    // Elements don't exist, skip initialization
                    return;
                }
                
                // Wait for guild data to be loaded
                if (!guildData || !guildData.roles) {
                    setTimeout(initAdvancedReactionRoles, 500);
                    return;
                }
                
                // Populate role dropdown for emoji/role pairs
                populateRoleDropdown();
                
                // Auto-load existing sets immediately
                loadReactionRoleSets();
                
                // Set up event listeners
                if (typeof setupReactionRoleEventListeners === 'function') {
                    setupReactionRoleEventListeners();
                }
            } catch (error) {
                // Silent error handling to prevent console spam
            }
        }

        function populateRoleDropdown() {
            const roleSelect = document.getElementById('newRoleSelect');
            if (!roleSelect) {
                console.log('newRoleSelect element not found - may not be in reactions tab');
                return;
            }
            
            if (!guildData || !guildData.roles || guildData.roles.length === 0) {
                console.log('Guild data not available, roles count:', guildData?.roles?.length || 0);
                return;
            }
            
            console.log('Populating role dropdown with', guildData.roles.length, 'roles');
            
            // Remove all existing options first
            while (roleSelect.firstChild) {
                roleSelect.removeChild(roleSelect.firstChild);
            }
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a role...';
            roleSelect.appendChild(defaultOption);
            
            // Add each role
            guildData.roles.forEach((role, index) => {
                if (role && role.id && role.name) {
                    const option = document.createElement('option');
                    option.value = role.id;
                    option.textContent = `@${role.name}`;
                    roleSelect.appendChild(option);
                    console.log(`Added role: ${role.name}`);
                }
            });
            
            console.log('Role dropdown populated successfully with', roleSelect.children.length - 1, 'roles');
        }
        


        function setupReactionRoleEventListeners() {
            // Create set form
            const createSetForm = document.getElementById('createSetForm');
            if (createSetForm) {
                createSetForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    createNewReactionSet();
                });
            }

            // Add emoji/role pair form
            const addPairForm = document.getElementById('addEmojiRoleForm');
            if (addPairForm) {
                addPairForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    addEmojiRolePair();
                });
            }
        }

        async function createNewReactionSet() {
            const setName = document.getElementById('newSetName').value.trim();
            const messageId = document.getElementById('newSetMessageId').value.trim();
            const setMode = document.getElementById('newSetMode').value;
            const createBtn = document.getElementById('createSetBtn');
            const resultDiv = document.getElementById('messageValidationResult');

            if (!setName) {
                showPopupNotification('Please enter a set name', false);
                return;
            }

            if (!messageId) {
                showPopupNotification('Please enter a message ID', false);
                return;
            }

            // Show validation progress
            createBtn.disabled = true;
            createBtn.textContent = 'Validating message...';
            resultDiv.style.display = 'none';

            try {
                // Validate message ID first
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // Increased timeout

                const response = await fetch('/api/validate-message-id', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        messageId: messageId,
                        serverId: currentServerId || 'default'
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const responseText = await response.text();
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Failed to parse response as JSON:', responseText);
                    throw new Error('Server returned invalid response format');
                }

                if (!result.success) {
                    resultDiv.innerHTML = `
                        <div style="padding: 8px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; border-radius: 6px; color: #ef4444; font-size: 14px;">
                            ❌ ${result.message || 'Message not found'}
                        </div>
                    `;
                    resultDiv.style.display = 'block';
                    return;
                }

                // Show validation success
                resultDiv.innerHTML = `
                    <div style="padding: 8px 12px; background: rgba(34, 197, 94, 0.2); border: 1px solid #3b82f6; border-radius: 6px; color: #3b82f6; font-size: 14px;">
                        ✅ Message found! "${result.messageContent}" in #${result.channelName}
                    </div>
                `;
                resultDiv.style.display = 'block';

                // Continue with set creation
                createBtn.textContent = 'Creating set...';

                // Wait a moment to show the success message
                await new Promise(resolve => setTimeout(resolve, 500));

                // Initialize new set
                currentReactionSet = {
                    setName: setName,
                    messageId: messageId,
                    setMode: setMode,
                    pairs: []
                };

                // Show emoji/role builder
                document.getElementById('newSetCreation').style.display = 'none';
                document.getElementById('emojiRoleBuilder').style.display = 'block';

                // Update current set info
                const setInfo = document.getElementById('currentSetInfo');
                setInfo.innerHTML = `
                    <strong>Set Name:</strong> ${setName}<br>
                    <strong>Message ID:</strong> ${messageId}<br>
                    <strong>Selection Mode:</strong> ${setMode}
                `;

                // Reset form inputs
                document.getElementById('newEmojiInput').value = '';
                document.getElementById('newRoleSelect').value = '';
                document.getElementById('pairsList').innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); font-style: italic; margin: 0;">No pairs added yet</p>';
                document.getElementById('applySetBtn').disabled = true;

                showPopupNotification('Message validated! Now add emoji/role pairs.', true);

            } catch (error) {
                console.error('Error validating message ID:', error);
                let errorMessage = 'Network error occurred';
                
                if (error.name === 'AbortError') {
                    errorMessage = 'Request timed out (took too long)';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                resultDiv.innerHTML = `
                    <div style="padding: 8px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; border-radius: 6px; color: #ef4444; font-size: 14px;">
                        ❌ Error checking message: ${errorMessage}
                    </div>
                `;
                resultDiv.style.display = 'block';
                showPopupNotification('Failed to validate message ID. Please try again.', false);
            } finally {
                createBtn.disabled = false;
                createBtn.textContent = 'Create Set & Continue';
            }
        }

        function addEmojiRolePair() {
            const emoji = document.getElementById('newEmojiInput').value.trim();
            const roleId = document.getElementById('newRoleSelect').value;

            if (!emoji || !roleId) {
                showPopupNotification('Please enter both emoji and role', false);
                return;
            }

            // Check if emoji already exists in current set
            if (currentReactionSet.pairs.some(pair => pair.emoji === emoji)) {
                showPopupNotification('This emoji is already used in this set', false);
                return;
            }

            // Get role name for display
            const roleOption = document.querySelector(`#newRoleSelect option[value="${roleId}"]`);
            const roleName = roleOption ? roleOption.textContent : 'Unknown Role';

            // Add pair to current set
            currentReactionSet.pairs.push({
                emoji: emoji,
                roleId: roleId,
                roleName: roleName
            });

            // Update pairs display
            updatePairsDisplay();

            // Clear inputs
            document.getElementById('newEmojiInput').value = '';
            document.getElementById('newRoleSelect').value = '';

            // Enable apply button if pairs exist
            const applyBtn = document.getElementById('applySetBtn');
            applyBtn.disabled = currentReactionSet.pairs.length === 0;

            showPopupNotification(`Added ${emoji} → ${roleName}`, true);
        }

        function updatePairsDisplay() {
            const pairsList = document.getElementById('pairsList');
            
            if (currentReactionSet.pairs.length === 0) {
                if (pairsList) {
                    pairsList.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); font-style: italic; margin: 0;">No pairs added yet</p>';
                }
                return;
            }

            let pairsHTML = '';
            currentReactionSet.pairs.forEach((pair, index) => {
                pairsHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; margin-bottom: 5px;">
                        <span>${pair.emoji} → ${pair.roleName}</span>
                        <button type="button" onclick="removePair(${index})" class="trendy-btn-sm trendy-btn-danger">Remove</button>
                    </div>
                `;
            });

            if (pairsList) {
                pairsList.innerHTML = pairsHTML;
            }
        }

        function removePair(index) {
            currentReactionSet.pairs.splice(index, 1);
            updatePairsDisplay();
            
            // Disable apply button if no pairs
            const applyBtn = document.getElementById('applySetBtn');
            applyBtn.disabled = currentReactionSet.pairs.length === 0;
        }

        function cancelSetCreation() {
            // Reset and hide builder
            currentReactionSet = { setName: '', messageId: '', setMode: 'multiple', pairs: [] };
            document.getElementById('newSetCreation').style.display = 'block';
            document.getElementById('emojiRoleBuilder').style.display = 'none';
            
            // Clear form
            document.getElementById('newSetName').value = '';
            document.getElementById('newSetMessageId').value = '';
            document.getElementById('newSetMode').value = 'multiple';
            
            // Clear emoji pairs display
            updatePairsDisplay();
            
            // Clear current set info
            const setInfo = document.getElementById('currentSetInfo');
            if (setInfo) {
                setInfo.innerHTML = '';
            }
        }

        async function applyReactionRoleSet() {
            try {
                // Prevent any form submission behavior
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }

                if (!currentReactionSet || currentReactionSet.pairs.length === 0) {
                    showPopupNotification('Please add at least one emoji/role pair', false);
                    return false;
                }

                if (!currentReactionSet.messageId || !currentReactionSet.messageId.trim()) {
                    showPopupNotification('Please enter a valid message ID', false);
                    return false;
                }

                console.log('Creating reaction role set:', currentReactionSet);
                showProcessing();

                const response = await fetch('/api/reaction-roles/create-set', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        setName: currentReactionSet.setName,
                        messageId: currentReactionSet.messageId,
                        setMode: currentReactionSet.setMode,
                        pairs: currentReactionSet.pairs,
                        serverId: currentServerId
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('Server response:', result);
                
                showPopupNotification(result.message, result.success);

                if (result.success) {
                    // Reset form and refresh sets
                    cancelSetCreation();
                    setTimeout(() => refreshReactionSets(), 500);
                }
            } catch (error) {
                console.error('Error creating reaction role set:', error);
                showPopupNotification(`Error: ${error.message}`, false);
            } finally {
                hideProcessing();
            }

            return false; // Prevent any form submission
        }

        function loadReactionRoleSets() {
            const existingSetsContainer = document.getElementById('existingSets');
            if (existingSetsContainer) {
                try {
                    existingSetsContainer.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); font-style: italic; margin: 0;">Loading sets...</p>';
                    refreshReactionSets();
                } catch (error) {
                    console.log('Error setting innerHTML for existingSets:', error.message);
                }
            } else {
                console.log('existingSets container not found - skipping reaction role sets loading');
            }
        }

        async function refreshReactionSets() {
            try {
                const existingSetsContainer = document.getElementById('existingSets');
                if (!existingSetsContainer) {
                    return;
                }

                // Show loading state
                existingSetsContainer.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6);">Loading and validating sets...</p>';

                const response = await fetch('/api/reaction-roles/get-sets');
                const result = await response.json();

                if (result.success) {
                    displayExistingSets(result.sets);
                    
                    // Check if any sets were found
                    if (result.sets.length === 0) {
                        existingSetsContainer.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); font-style: italic;">No reaction role sets found or all sets have been cleaned up due to missing messages</p>';
                    }
                } else {
                    if (existingSetsContainer) {
                        try {
                            existingSetsContainer.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6);">No reaction role sets found</p>';
                        } catch (error) {
                            console.log('Error setting innerHTML (no sets found):', error.message);
                        }
                    }
                }
            } catch (error) {
                const existingSetsContainer = document.getElementById('existingSets');
                if (existingSetsContainer) {
                    try {
                        existingSetsContainer.innerHTML = '<p style="color: #ef4444;">Error loading sets</p>';
                    } catch (innerError) {
                        console.log('Error setting innerHTML (error message):', innerError.message);
                    }
                }
            }
        }

        function displayExistingSets(sets) {
            const container = document.getElementById('existingSets');
            if (!container) {
                return;
            }
            
            if (!sets || sets.length === 0) {
                if (container) {
                    try {
                        container.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6); font-style: italic;">No reaction role sets configured yet</p>';
                    } catch (error) {
                        console.log('Error setting innerHTML (no sets):', error.message);
                    }
                }
                return;
            }

            let setsHTML = '';
            const groupedSets = {};

            // Group by set_id
            sets.forEach(set => {
                if (!groupedSets[set.set_id]) {
                    groupedSets[set.set_id] = {
                        setName: set.set_name || 'Unnamed Set',
                        messageId: set.message_id,
                        setMode: set.set_mode,
                        reactions: []
                    };
                }
                groupedSets[set.set_id].reactions.push(set);
            });

            Object.keys(groupedSets).forEach(setId => {
                const setData = groupedSets[setId];
                
                // Create reaction pairs display with proper role names
                let reactionsHTML = '';
                setData.reactions.forEach(reaction => {
                    // Get role name from guild data
                    let roleName = 'Unknown Role';
                    if (guildData && guildData.roles) {
                        const roleData = guildData.roles.find(r => r.id === reaction.role_id);
                        if (roleData) {
                            roleName = roleData.name;
                        }
                    }
                    
                    reactionsHTML += `
                        <div style="background: rgba(124, 58, 237, 0.2); padding: 6px 10px; border-radius: 4px; font-size: 12px; margin: 2px;">
                            <span style="font-weight: bold;">${reaction.emoji_id}</span> → <span style="color: #3b82f6;">@${roleName}</span>
                        </div>
                    `;
                });
                
                setsHTML += `
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="margin: 0; color: #3b82f6;">${setData.setName}</h5>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="reapplyReactionSet('${setId}')" class="trendy-btn-sm trendy-btn-primary">Reapply Set</button>
                                <button onclick="deleteReactionSet('${setId}')" class="trendy-btn-sm trendy-btn-danger">Delete Set</button>
                            </div>
                        </div>
                        <p style="margin: 5px 0; font-size: 14px;">
                            <strong>Set ID:</strong> ${setId}<br>
                            <strong>Message ID:</strong> ${setData.messageId}<br>
                            <strong>Mode:</strong> ${setData.setMode === 'single' ? 'Single Selection' : 'Multiple Selection'}
                        </p>
                        <div style="margin-top: 10px;">
                            <strong>Reaction Role Mappings:</strong>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 5px;">
                                ${reactionsHTML}
                            </div>
                        </div>
                    </div>
                `;
            });

            if (container) {
                try {
                    container.innerHTML = setsHTML;
                } catch (error) {
                    console.log('Error setting innerHTML in displayExistingSets:', error.message);
                }
            }
        }

        async function reapplyReactionSet(setId) {
            if (!confirm(`Are you sure you want to reapply reactions for set "${setId}"? This will add missing emojis to the Discord message.`)) {
                return;
            }

            showProcessing();

            try {
                const response = await fetch('/api/reaction-roles/reapply-set', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ setId })
                });

                const result = await response.json();
                showPopupNotification(result.message, result.success);
            } catch (error) {
                showPopupNotification('Error reapplying reaction role set', false);
            }

            hideProcessing();
        }

        async function deleteReactionSet(setId) {
            if (!confirm(`Are you sure you want to delete reaction role set "${setId}"?`)) {
                return;
            }

            showProcessing();

            try {
                const response = await fetch('/api/reaction-roles/delete-set', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ setId })
                });

                const result = await response.json();
                showPopupNotification(result.message, result.success);

                if (result.success) {
                    refreshReactionSets();
                }
            } catch (error) {
                showPopupNotification('Error deleting reaction role set', false);
            }

            hideProcessing();
        }

        // Legacy function for backwards compatibility - replaced by advanced reaction roles
        function loadReactionRoles(reactionRoles) {
            // No longer used - advanced reaction roles system handles this
            // Legacy loadReactionRoles called - using advanced system instead
            
            // Prevent errors by ensuring all reaction role elements exist
            const reactionContainer = document.getElementById('reactionRoles');
            if (reactionContainer && !reactionContainer.innerHTML.trim()) {
                reactionContainer.innerHTML = '<p style="color: rgba(255, 255, 255, 0.6);">Legacy reaction roles disabled - use Advanced Reaction Roles instead</p>';
            }
        }

        // Load welcomer settings
        function loadWelcomerSettings(data) {
            const welcomer = data.welcomer || {};
            
            if (document.getElementById('welcomerEnabled')) {
                document.getElementById('welcomerEnabled').checked = welcomer.enabled || false;
            }
            if (document.getElementById('welcomeChannel')) {
                document.getElementById('welcomeChannel').value = welcomer.channelId || '';
            }
            if (document.getElementById('useEmbed')) {
                document.getElementById('useEmbed').value = welcomer.useEmbed ? 'true' : 'false';
            }
            if (document.getElementById('welcomeMessage')) {
                document.getElementById('welcomeMessage').value = welcomer.message || 'Welcome {user} to the server!';
            }
            if (document.getElementById('embedTitle')) {
                document.getElementById('embedTitle').value = welcomer.embedTitle || 'Welcome!';
            }
            if (document.getElementById('embedDescription')) {
                document.getElementById('embedDescription').value = welcomer.embedDescription || 'Welcome {user} to our server!';
            }
            if (document.getElementById('embedColor')) {
                document.getElementById('embedColor').value = welcomer.embedColor || '#00ff00';
            }
            
            // Update visibility based on useEmbed setting
            toggleEmbedSection();
        }

        // Load forum auto-react settings
        function loadForumAutoReactSettings(data) {
            try {
                const othersData = data.others || {};
                
                // Load auto react checkbox
                const forumAutoReactEl = document.getElementById('forumAutoReact');
                if (forumAutoReactEl) {
                    forumAutoReactEl.checked = othersData.forum_auto_react_enabled || false;
                }
                
                // Load forum channel selection and emoji lists
                if (othersData.forum_channels) {
                    let forumChannelsData = {};
                    try {
                        forumChannelsData = typeof othersData.forum_channels === 'string' 
                            ? JSON.parse(othersData.forum_channels) 
                            : othersData.forum_channels;
                    } catch (e) {
                        console.log('Error parsing forum_channels data:', e);
                    }
                    
                    // Set selected forum channel
                    const forumChannelSelectEl = document.getElementById('forumChannelSelect');
                    if (forumChannelSelectEl && forumChannelsData.selectedForum) {
                        forumChannelSelectEl.value = forumChannelsData.selectedForum;
                    }
                    
                    // Set bot emoji lists
                    const bot1EmojiEl = document.getElementById('bot1EmojiList');
                    const bot2EmojiEl = document.getElementById('bot2EmojiList');
                    if (bot1EmojiEl && forumChannelsData.bot1EmojiList) {
                        bot1EmojiEl.value = forumChannelsData.bot1EmojiList;
                    }
                    if (bot2EmojiEl && forumChannelsData.bot2EmojiList) {
                        bot2EmojiEl.value = forumChannelsData.bot2EmojiList;
                    }
                }
                
                console.log('Forum auto-react settings loaded successfully');
            } catch (error) {
                console.error('Error loading forum auto-react settings:', error);
            }
        }


        // Setup event listeners when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // Setup welcome toggle functionality
            setupWelcomeToggle();
            
            // Form submissions with processing overlay and popup notifications
            
            // Universal form submission handler
            function handleFormSubmission(formId, endpoint, fieldMapping, errorMessage) {
                const form = document.getElementById(formId);
                if (!form) return;
                
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showProcessing();
                    
                    const formData = {};
                    Object.keys(fieldMapping).forEach(key => {
                        const element = document.getElementById(fieldMapping[key]);
                        formData[key] = element ? element.value : '';
                    });
                    formData.serverId = currentServerId;
                    
                    try {
                        const response = await fetch(endpoint, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(formData)
                        });
                        
                        const result = await response.json();
                        showPopupNotification(result.message, result.success);
                    } catch (error) {
                        showPopupNotification(errorMessage, false);
                    } finally {
                        hideProcessing();
                    }
                });
            }
            
            // Bot 1 AI Details Form
            handleFormSubmission('bot1PersonalityForm', '/api/update-bot1-personality', {
                age: 'bot1Age',
                appearance: 'bot1Appearance',
                personality: 'bot1Personality',
                likes: 'bot1Likes',
                dislikes: 'bot1Dislikes',
                backstory: 'bot1Backstory',
                others: 'bot1Others'
            }, 'Error updating Bot 1 AI details');

            // Bot 2 AI Details Form
            handleFormSubmission('bot2PersonalityForm', '/api/update-bot2-personality', {
                age: 'bot2Age',
                appearance: 'bot2Appearance',
                personality: 'bot2Personality',
                likes: 'bot2Likes',
                dislikes: 'bot2Dislikes',
                backstory: 'bot2Backstory',
                others: 'bot2Others'
            }, 'Error updating Bot 2 AI details');

            // Bot 1 General Form
            const bot1GeneralForm = document.getElementById('bot1GeneralForm');
            if (bot1GeneralForm) {
                bot1GeneralForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showProcessing();
                    
                    const formData = new FormData();
                    formData.append('name', document.getElementById('bot1Name').value);
                    formData.append('description', document.getElementById('bot1Description').value);
                    formData.append('status', document.getElementById('bot1Status').value);
                    formData.append('activityType', document.getElementById('bot1ActivityType').value);
                    formData.append('activityText', document.getElementById('bot1ActivityText').value);
                    formData.append('allowedChannels', document.getElementById('bot1AllowedChannels').value);
                    formData.append('serverId', currentServerId);
                    
                    const avatarFile = document.getElementById('bot1Avatar').files[0];
                    if (avatarFile) {
                        formData.append('avatar', avatarFile);
                    }
                    
                    try {
                        const response = await fetch('/api/update-bot1-general', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        showPopupNotification(result.message, result.success);
                        
                        // Reload dashboard data to reflect changes
                        if (result.success) {
                            loadDashboardData();
                        }
                    } catch (error) {
                        showPopupNotification('Error updating Bot 1 general settings', false);
                    }
                    hideProcessing();
                });
            }

            // Bot 2 General Form
            const bot2GeneralForm = document.getElementById('bot2GeneralForm');
            if (bot2GeneralForm) {
                bot2GeneralForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showProcessing();
                    
                    const formData = new FormData();
                    formData.append('name', document.getElementById('bot2Name').value);
                    formData.append('description', document.getElementById('bot2Description').value);
                    formData.append('status', document.getElementById('bot2Status').value);
                    formData.append('activityType', document.getElementById('bot2ActivityType').value);
                    formData.append('activityText', document.getElementById('bot2ActivityText').value);
                    formData.append('allowedChannels', document.getElementById('bot2AllowedChannels').value);
                    formData.append('serverId', currentServerId);
                    
                    const avatarFile = document.getElementById('bot2Avatar').files[0];
                    if (avatarFile) {
                        formData.append('avatar', avatarFile);
                    }
                    
                    try {
                        const response = await fetch('/api/update-bot2-general', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        showPopupNotification(result.message, result.success);
                        
                        // Reload dashboard data to reflect changes
                        if (result.success) {
                            loadDashboardData();
                        }
                    } catch (error) {
                        showPopupNotification('Error updating Bot 2 general settings', false);
                    }
                    hideProcessing();
                });
            }

            // XP Settings form
            const xpForm = document.getElementById('xpForm');
            if (xpForm) {
                xpForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showProcessing();
                    
                    const formData = {
                        minXp: parseInt(document.getElementById('minXp').value),
                        maxXp: parseInt(document.getElementById('maxXp').value),
                        xpCooldown: parseInt(document.getElementById('xpCooldown').value) * 1000, // Convert seconds to milliseconds
                        serverId: currentServerId
                    };
                    
                    try {
                        const response = await fetch('/api/update-xp-settings', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(formData)
                        });
                        
                        const result = await response.json();
                        showPopupNotification(result.message, result.success);
                    } catch (error) {
                        showPopupNotification('Error updating XP settings', false);
                    }
                    hideProcessing();
                });
            }

            // Announcement Settings form
            const announcementForm = document.getElementById('announcementForm');
            if (announcementForm) {
                announcementForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showProcessing();
                    
                    const formData = {
                        levelAnnouncements: document.getElementById('levelAnnouncements').checked,
                        announcementChannel: document.getElementById('announcementChannel').value,
                        serverId: currentServerId
                    };
                    
                    try {
                        const response = await fetch('/api/update-announcement-settings', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(formData)
                        });
                        
                        const result = await response.json();
                        showPopupNotification(result.message, result.success);
                    } catch (error) {
                        showPopupNotification('Error updating announcement settings', false);
                    }
                    hideProcessing();
                });
            }

            // Thread XP form
            const threadXpForm = document.getElementById('threadXpForm');
            if (threadXpForm) {
                threadXpForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showProcessing();
                    
                    const formData = {
                        threadXp: parseInt(document.getElementById('threadXp').value),
                        serverId: currentServerId
                    };
                    
                    try {
                        const response = await fetch('/api/update-thread-xp', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(formData)
                        });
                        
                        const result = await response.json();
                        showPopupNotification(result.message, result.success);
                    } catch (error) {
                        showPopupNotification('Error updating thread XP settings', false);
                    }
                    hideProcessing();
                });
            }

            // Role Rewards form
            const roleRewardsForm = document.getElementById('roleRewardsForm');
            if (roleRewardsForm) {
                roleRewardsForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showProcessing();
                    
                    const roleRewards = [];
                    document.querySelectorAll('.role-item').forEach(item => {
                        const level = item.querySelector('input[type="number"]').value;
                        const roleId = item.querySelector('select').value;
                        if (level && roleId) {
                            roleRewards.push({ level: parseInt(level), roleId });
                        }
                    });
                    
                    const formData = {
                        roleRewards,
                        serverId: currentServerId || '1206274128588578826'
                    };
                    
                    try {
                        const response = await fetch('/api/update-role-rewards', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(formData)
                        });
                        
                        const result = await response.json();
                        showPopupNotification(result.message, result.success);
                    } catch (error) {
                        console.error('Role rewards error:', error);
                        console.error('Error details:', error.message);
                        showPopupNotification('Error updating role rewards: ' + error.message, false);
                    } finally {
                        hideProcessing();
                    }
                });
            }



            // Reaction form
            const reactionsForm = document.getElementById('reactionsForm');
            if (reactionsForm) {
                reactionsForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showProcessing();
                    
                    const reactionRoles = [];
                    document.querySelectorAll('.reaction-item').forEach(item => {
                        const messageId = item.querySelector('input[placeholder*="Message ID"]').value;
                        const emoji = item.querySelector('input[placeholder*="emoji"]').value;
                        const roles = Array.from(item.querySelectorAll('select option:checked')).map(opt => opt.value);
                        
                        if (messageId && emoji && roles.length > 0) {
                            reactionRoles.push({ messageId, emoji, roles });
                        }
                    });
                    
                    const formData = {
                        reactionRoles,
                        reactionRoleMode: document.getElementById('reactionRoleMode').value,
                        emojiMode: document.getElementById('emojiMode').value,
                        serverId: currentServerId
                    };
                    
                    try {
                        const response = await fetch('/api/update-reactions', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(formData)
                        });
                        
                        const result = await response.json();
                        showPopupNotification(result.message, result.success);
                    } catch (error) {
                        showPopupNotification('Error updating reaction roles', false);
                    }
                    hideProcessing();
                });
            }
        }

        // Welcomer settings functions
        function loadWelcomerSettings(data) {
            if (data.welcomer) {
                const welcomerEnabledEl = document.getElementById('welcomerEnabled');
                const welcomeChannelEl = document.getElementById('welcomeChannel');
                const useEmbedEl = document.getElementById('useEmbed');
                const welcomeMessageEl = document.getElementById('welcomeMessage');
                const embedTitleEl = document.getElementById('embedTitle');
                const embedDescriptionEl = document.getElementById('embedDescription');
                const embedColorEl = document.getElementById('embedColor');
                
                if (welcomerEnabledEl) welcomerEnabledEl.checked = data.welcomer.enabled || false;
                if (welcomeChannelEl) welcomeChannelEl.value = data.welcomer.channelId || '';
                if (useEmbedEl) useEmbedEl.value = data.welcomer.useEmbed ? 'true' : 'false';
                if (welcomeMessageEl) welcomeMessageEl.value = data.welcomer.message || 'Welcome {user} to the server!';
                if (embedTitleEl) embedTitleEl.value = data.welcomer.embedTitle || 'Welcome!';
                if (embedDescriptionEl) embedDescriptionEl.value = data.welcomer.embedDescription || 'Welcome {user} to our server!';
                if (embedColorEl) embedColorEl.value = data.welcomer.embedColor || '#00ff00';
                
                toggleEmbedSection();
            }
        }

        function toggleEmbedSection() {
            const useEmbedEl = document.getElementById('useEmbed');
            const textMessageSectionEl = document.getElementById('textMessageSection');
            const embedSectionEl = document.getElementById('embedSection');
            
            if (useEmbedEl && textMessageSectionEl && embedSectionEl) {
                const useEmbed = useEmbedEl.checked;
                textMessageSectionEl.style.display = useEmbed ? 'none' : 'block';
                embedSectionEl.style.display = useEmbed ? 'block' : 'none';
            }
        }

        // Custom rank card settings functions
        // Forum auto-react settings functions
        function loadForumAutoReactSettings(data) {
            if (data.forumAutoReact) {
                const forumAutoReactEl = document.getElementById('forumAutoReact');
                const forumChannelSelectEl = document.getElementById('forumChannelSelect');
                const bot1EmojiListEl = document.getElementById('bot1EmojiList');
                const bot2EmojiListEl = document.getElementById('bot2EmojiList');
                
                if (forumAutoReactEl) forumAutoReactEl.checked = data.forumAutoReact.allForums || false;
                if (forumChannelSelectEl) forumChannelSelectEl.value = data.forumAutoReact.selectedForum || '';
                if (bot1EmojiListEl) bot1EmojiListEl.value = data.forumAutoReact.bot1EmojiList || '';
                if (bot2EmojiListEl) bot2EmojiListEl.value = data.forumAutoReact.bot2EmojiList || '';
            }
        }

        // Optimized channel dropdown population for both bots
        function populateChannelDropdowns(selectedChannel = '') {
            const selectors = [
                'bot1AllowedChannels', 'bot2AllowedChannels',
                'welcomeChannel', 'messageChannel', 'embedChannel', 'announcementChannel'
            ];
            
            selectors.forEach(selectorId => {
                const select = document.getElementById(selectorId);
                if (select && guildData && guildData.channels) {
                    // Set default option based on selector type
                    if (selectorId.includes('AllowedChannels')) {
                        select.innerHTML = '<option value="">All Channels (Default)</option>';
                    } else if (selectorId === 'announcementChannel') {
                        select.innerHTML = '<option value="">Auto-detect (Default)</option>';
                    } else {
                        select.innerHTML = '<option value="">Select a channel...</option>';
                    }
                    
                    // Populate channels - include text, voice, stage, and announcement (exclude forum)
                    guildData.channels.forEach(channel => {
                        if (channel.type !== 15) { // Exclude forum channels
                            const option = document.createElement('option');
                            option.value = channel.id;
                            
                            // Add appropriate prefix based on channel type
                            let prefix = '#';
                            if (channel.type === 2) prefix = '🔊'; // Voice channels
                            else if (channel.type === 13) prefix = '🎤'; // Stage channels
                            else if (channel.type === 5) prefix = '📢'; // Announcement channels
                            
                            option.textContent = `${prefix}${channel.name}`;
                            
                            if (selectorId.includes('AllowedChannels') && selectedChannel === channel.id) {
                                option.selected = true;
                            }
                            
                            select.appendChild(option);
                        }
                    });
                }
            });
            
            // Populate forum channels
            const forumSelect = document.getElementById('forumChannelSelect');
            if (forumSelect && guildData && guildData.channels) {
                forumSelect.innerHTML = '<option value="">Select a forum channel</option>';
                
                guildData.channels.forEach(channel => {
                    if (channel.type === 15) { // Forum channels
                        const option = document.createElement('option');
                        option.value = channel.id;
                        option.textContent = channel.name;
                        forumSelect.appendChild(option);
                    }
                });
            }
        }

        // Add event listeners for new forms
        document.getElementById('welcomerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                welcomer_enabled: document.getElementById('welcomerEnabled')?.checked || false,
                welcomer_channel: document.getElementById('welcomeChannel')?.value || '',
                welcomer_embed_enabled: document.getElementById('useEmbed')?.value === 'true',
                welcomer_message: document.getElementById('welcomeMessage')?.value || '',
                welcomer_embed_title: document.getElementById('embedTitle')?.value || '',
                welcomer_embed_description: document.getElementById('embedDescription')?.value || '',
                welcomer_embed_color: document.getElementById('embedColor')?.value || '#7c3aed',
                welcomer_embed_thumbnail: document.getElementById('embedThumbnail')?.checked || false,
                welcomer_embed_footer: document.getElementById('welcomeEmbedFooter')?.value || ''
            };
            
            try {
                const response = await fetch('/api/update-welcomer-settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                showPopupNotification(result.message, result.success);
            } catch (error) {
                showPopupNotification('Error updating welcomer settings', false);
            }
        });

        // Auto role form handler removed - using improved handler below

        // Update reactions form to include new settings
        const reactionsFormOld = document.getElementById('reactionsForm');
        if (reactionsFormOld) {
            reactionsFormOld.addEventListener('submit', async (e) => {
                e.preventDefault();
            
            const reactionRoles = [];
            document.querySelectorAll('.reaction-item').forEach(item => {
                const messageId = item.querySelector('input[placeholder="Message ID"]').value;
                const emoji = item.querySelector('input[placeholder*="Emoji"]').value;
                const roleSelect = item.querySelector('select');
                const roles = roleSelect.value ? [roleSelect.value] : [];
                
                if (messageId && emoji && roles.length > 0) {
                    reactionRoles.push({ messageId, emoji, roles });
                }
            });
            
            const formData = {
                forumAutoReact: {
                    allForums: document.getElementById('forumAutoReact').checked,
                    messageReact: {
                        enabled: true, // Always enabled now
                        messageId: document.getElementById('messageReactId').value
                    }
                },
                reactionRoles
            };
            
                try {
                    const response = await fetch('/api/update-reactions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    showPopupNotification(result.message, result.success);
                } catch (error) {
                    showPopupNotification('Error updating reaction settings', false);
                }
            });
        }

        // Update levels form to include custom rank card settings
        const levelsForm = document.getElementById('levelsForm');
        if (levelsForm) {
            levelsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Collect role rewards
                const roleRewards = [];
                document.querySelectorAll('.role-item').forEach(item => {
                    const level = item.querySelector('input[type="number"]').value;
                    const roleId = item.querySelector('select').value;
                    if (level && roleId) {
                        roleRewards.push({ level: parseInt(level), roleId });
                    }
                });
                
                const formData = {
                    minXp: parseInt(document.getElementById('minXp').value) || 1,
                    maxXp: parseInt(document.getElementById('maxXp').value) || 15,
                    xpCooldown: (parseInt(document.getElementById('xpCooldown').value) || 60) * 1000,
                    levelAnnouncements: document.getElementById('levelAnnouncements').checked,
                    announcementChannel: document.getElementById('announcementChannel').value,
                    levelRoles: roleRewards,
                    customRankCard: {
                        backgroundColor: document.getElementById('rankCardBg').value,
                        progressBarColor: document.getElementById('rankCardProgress').value,
                        textColor: document.getElementById('rankCardText').value,
                        accentColor: document.getElementById('rankCardAccent').value,
                        cardStyle: document.getElementById('rankCardStyle').value
                    }
                };
                
                try {
                    const response = await fetch('/api/update-levels', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    showPopupNotification(result.message, result.success);
                } catch (error) {
                    showPopupNotification('Error updating level settings', false);
                }
            });
        }

        // Messages form handlers
        const sendMessageForm = document.getElementById('sendMessageForm');
        if (sendMessageForm) {
            sendMessageForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                showProcessing();
                
                const formData = new FormData();
                formData.append('channelId', document.getElementById('messageChannel').value);
                formData.append('message', document.getElementById('messageText').value);
                formData.append('botId', document.getElementById('messageBotSelection').value);
                
                const files = document.getElementById('messageFiles').files;
                for (let i = 0; i < files.length && i < 5; i++) {
                    formData.append(`file${i + 1}`, files[i]);
                }
                
                try {
                    const response = await fetch('/api/send-message', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    showPopupNotification(result.message, result.success);
                    
                    if (result.success) {
                        // Clear only the message text and files, keep channel and bot selection
                        document.getElementById('messageText').value = '';
                        document.getElementById('messageFiles').value = '';
                    }
                } catch (error) {
                    showPopupNotification('Error sending message', false);
                } finally {
                    hideProcessing();
                }
            });
        }

        document.getElementById('sendEmbedForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            showProcessing();
            
            const formData = {
                channelId: document.getElementById('embedChannel').value,
                title: document.getElementById('embedMessageTitle').value,
                description: document.getElementById('embedMessageDescription').value,
                color: document.getElementById('embedMessageColor').value,
                image: document.getElementById('embedImageUrl').value,
                thumbnail: document.getElementById('embedThumbnailUrl').value,
                footer: document.getElementById('embedFooterText').value,
                timestamp: document.getElementById('embedTimestamp').checked,
                botId: document.getElementById('embedBotSelection').value
            };
            
            try {
                const response = await fetch('/api/send-embed', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                showPopupNotification(result.message, result.success);
                
                if (result.success) {
                    // Clear only embed content fields, keep channel and bot selection
                    document.getElementById('embedMessageTitle').value = '';
                    document.getElementById('embedMessageDescription').value = '';
                    document.getElementById('embedMessageColor').value = '#0099ff';
                    document.getElementById('embedImageUrl').value = '';
                    document.getElementById('embedThumbnailUrl').value = '';
                    document.getElementById('embedFooterText').value = '';
                    document.getElementById('embedTimestamp').checked = false;
                }
            } catch (error) {
                showPopupNotification('Error sending embed', false);
            } finally {
                hideProcessing();
            }
        });

        // Optimized welcomer form handler with debouncing
        let welcomerSubmitTimeout;
        document.getElementById('welcomerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Debounce rapid submissions
            if (welcomerSubmitTimeout) {
                clearTimeout(welcomerSubmitTimeout);
            }
            
            welcomerSubmitTimeout = setTimeout(async () => {
                showProcessing();
                
                const formData = {
                    enabled: document.getElementById('welcomerEnabled').checked,
                    channelId: document.getElementById('welcomeChannel').value,
                    message: document.getElementById('welcomeMessage').value,
                    useEmbed: document.getElementById('useEmbed').value === 'true',
                    embedTitle: document.getElementById('embedTitle').value,
                    embedDescription: document.getElementById('embedDescription').value,
                    embedColor: document.getElementById('embedColor').value
                };
                
                try {
                    const response = await fetch('/api/update-welcomer', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    showPopupNotification(result.message, result.success);
                } catch (error) {
                    showPopupNotification('Error updating welcomer settings', false);
                } finally {
                    hideProcessing();
                }
            }, 500); // 500ms debounce delay
        });

        // Toggle welcome message format
        function setupWelcomeToggle() {
            const textToggle = document.getElementById('textToggle');
            const embedToggle = document.getElementById('embedToggle');
            const textSection = document.getElementById('textMessageSection');
            const embedSection = document.getElementById('embedSection');
            const useEmbedField = document.getElementById('useEmbed');
            
            if (textToggle && embedToggle && textSection && embedSection && useEmbedField) {
                textToggle.addEventListener('click', () => {
                    try {
                        textToggle.classList.add('active');
                        embedToggle.classList.remove('active');
                        textSection.style.display = 'block';
                        embedSection.style.display = 'none';
                        useEmbedField.value = 'false';
                    } catch (error) {
                        console.log('Error in text toggle:', error.message);
                    }
                });
                
                embedToggle.addEventListener('click', () => {
                    try {
                        embedToggle.classList.add('active');
                        textToggle.classList.remove('active');
                        textSection.style.display = 'none';
                        embedSection.style.display = 'block';
                        useEmbedField.value = 'true';
                    } catch (error) {
                        console.log('Error in embed toggle:', error.message);
                    }
                });
            }
        }

        // Auto Role Management Functions
        function addAutoRole(roleId = '') {
            const autoRolesList = document.getElementById('autoRolesList');
            const roleId_unique = Date.now();
            
            const roleDiv = document.createElement('div');
            roleDiv.className = 'role-item';
            roleDiv.id = `autoRole_${roleId_unique}`;
            roleDiv.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px; align-items: center;';
            
            roleDiv.innerHTML = `
                <select class="form-select" style="flex: 1;" data-role-select>
                    <option value="">Select a role...</option>
                    <!-- Roles will be populated by JavaScript -->
                </select>
                <button type="button" onclick="removeAutoRole('autoRole_${roleId_unique}')" class="trendy-btn trendy-btn-danger" style="padding: 8px 15px; font-size: 12px; border-radius: 6px;">Remove</button>
            `;
            
            autoRolesList.appendChild(roleDiv);
            
            // Populate roles
            populateRoleDropdown(roleDiv.querySelector('[data-role-select]'), roleId);
            
            return roleDiv;
        }

        function removeAutoRole(id) {
            document.getElementById(id).remove();
        }

        function populateRoleDropdown(selectElement, selectedRoleId = '') {
            // This will be populated when guild data is loaded
            if (guildData && guildData.roles) {
                selectElement.innerHTML = '<option value="">Select a role...</option>';
                guildData.roles.forEach(role => {
                    const option = document.createElement('option');
                    option.value = role.id;
                    option.textContent = `@${role.name}`;
                    option.selected = role.id === selectedRoleId;
                    selectElement.appendChild(option);
                });
            } else {
                // If no guild data, store the selected role ID for later population
                selectElement.innerHTML = '<option value="">Loading roles...</option>';
                if (selectedRoleId) {
                    selectElement.setAttribute('data-selected-role', selectedRoleId);
                    // Add temporary option with the selected role ID
                    const tempOption = document.createElement('option');
                    tempOption.value = selectedRoleId;
                    tempOption.textContent = `Role (${selectedRoleId})`;
                    tempOption.selected = true;
                    selectElement.appendChild(tempOption);
                }
            }
        }

        function loadAutoRoles(autoRoles) {
            const autoRolesList = document.getElementById('autoRolesList');
            autoRolesList.innerHTML = '';
            
            if (autoRoles && autoRoles.length > 0) {
                autoRoles.forEach(roleId => {
                    // Skip empty string representations of arrays
                    if (roleId && roleId !== "[]" && roleId.trim() !== "") {
                        addAutoRole(roleId.trim()); // Trim whitespace from role IDs
                    }
                });
                
                // If no valid roles were added, add an empty role
                if (autoRolesList.children.length === 0) {
                    addAutoRole(); // Add one empty role
                }
            } else {
                addAutoRole(); // Add one empty role
            }
        }

        function collectAutoRoles() {
            const roleSelects = document.querySelectorAll('#autoRolesList [data-role-select]');
            const roles = [];
            roleSelects.forEach(select => {
                if (select.value) {
                    roles.push(select.value);
                }
            });
            return roles;
        }

        function repopulateAutoRoleDropdowns() {
            const roleSelects = document.querySelectorAll('#autoRolesList [data-role-select]');
            roleSelects.forEach(selectElement => {
                const selectedRoleId = selectElement.getAttribute('data-selected-role') || selectElement.value;
                if (guildData && guildData.roles) {
                    selectElement.innerHTML = '<option value="">Select a role...</option>';
                    guildData.roles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role.id;
                        option.textContent = `@${role.name}`;
                        option.selected = role.id === selectedRoleId;
                        selectElement.appendChild(option);
                    });
                }
            });
        }

        // Load new welcomer settings from WelcomeMessage table
        function loadNewWelcomerSettings(welcomeData) {
            // Safe element updating with comprehensive null checks
            const safeUpdateElement = (id, value, isCheckbox = false) => {
                const element = document.getElementById(id);
                if (element && value !== null && value !== undefined) {
                    try {
                        if (isCheckbox) {
                            element.checked = Boolean(value);
                        } else {
                            element.value = String(value);
                        }
                    } catch (error) {
                        console.log(`Error setting ${id}:`, error.message);
                    }
                }
            };
            
            safeUpdateElement('welcomerEnabled', welcomeData.enabled || false, true);
            safeUpdateElement('welcomeChannel', welcomeData.channelId || '');
            safeUpdateElement('welcomeMessage', welcomeData.message || 'Welcome to the server, {user}!');
            safeUpdateElement('embedTitle', welcomeData.embedTitle || 'Welcome!');
            safeUpdateElement('embedDescription', welcomeData.embedDescription || 'Welcome to our server, {user}! We\'re glad you\'re here.');
            safeUpdateElement('embedColor', welcomeData.embedColor || '#7c3aed');
            safeUpdateElement('embedThumbnail', welcomeData.embedThumbnail !== false, true);
            safeUpdateElement('welcomeEmbedFooter', welcomeData.embedFooter || 'Have a great time!');
            
            // Set embed toggle state
            const embedEnabled = welcomeData.useEmbed || false;
            safeUpdateElement('useEmbed', embedEnabled ? 'true' : 'false');
            
            // Update UI based on embed state with enhanced error handling
            try {
                const textToggle = document.getElementById('textToggle');
                const embedToggle = document.getElementById('embedToggle');
                const textSection = document.getElementById('textMessageSection');
                const embedSection = document.getElementById('embedSection');
                
                if (embedEnabled) {
                    if (embedToggle) embedToggle.classList.add('active');
                    if (textToggle) textToggle.classList.remove('active');
                    if (textSection) textSection.style.display = 'none';
                    if (embedSection) embedSection.style.display = 'block';
                } else {
                    if (textToggle) textToggle.classList.add('active');
                    if (embedToggle) embedToggle.classList.remove('active');
                    if (textSection) textSection.style.display = 'block';
                    if (embedSection) embedSection.style.display = 'none';
                }
            } catch (error) {
                console.log('Error updating welcomer UI state:', error.message);
            }
        }

        // Load auto role settings from API data
        function loadAutoRoleSettings(autoRoleData) {
            if (document.getElementById('autoRoleEnabled')) {
                document.getElementById('autoRoleEnabled').checked = autoRoleData.enabled || false;
            }
            
            // Load auto roles
            const autoRoleIds = autoRoleData.roleIds || [];
            loadAutoRoles(autoRoleIds);
        }
        
        // Legacy function for compatibility
        function toggleEmbedSection() {
            const useEmbedEl = document.getElementById('useEmbed');
            const textSection = document.getElementById('textMessageSection');
            const embedSection = document.getElementById('embedSection');
            const textToggle = document.getElementById('textToggle');
            const embedToggle = document.getElementById('embedToggle');
            
            if (!useEmbedEl) return;
            
            try {
                const useEmbed = useEmbedEl.value === 'true';
                
                if (useEmbed) {
                    if (textSection) textSection.style.display = 'none';
                    if (embedSection) embedSection.style.display = 'block';
                    if (embedToggle) embedToggle.classList.add('active');
                    if (textToggle) textToggle.classList.remove('active');
                } else {
                    if (textSection) textSection.style.display = 'block';
                    if (embedSection) embedSection.style.display = 'none';
                    if (textToggle) textToggle.classList.add('active');
                    if (embedToggle) embedToggle.classList.remove('active');
                }
            } catch (error) {
                console.log('Error in toggleEmbedSection:', error.message);
            }
        }

        // Auto React form handler
        document.getElementById('autoReactForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            showProcessing();
            
            const formData = {
                forumAutoReact: {
                    allForums: document.getElementById('forumAutoReact').checked,
                    selectedForum: document.getElementById('forumChannelSelect').value,
                    bot1EmojiList: document.getElementById('bot1EmojiList').value,
                    bot2EmojiList: document.getElementById('bot2EmojiList').value
                }
            };
            
            try {
                const response = await fetch('/api/update-auto-react', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                showPopupNotification(result.message, result.success);
            } catch (error) {
                showPopupNotification('Error updating auto react settings', false);
            } finally {
                hideProcessing();
            }
        });

        // Message React form handler
        document.getElementById('messageReactForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const messageId = document.getElementById('messageReactId').value;
            const emojiList = document.getElementById('messageEmojiList').value;
            const botId = document.getElementById('messageReactBot').value;
            
            if (!messageId || !emojiList) {
                showPopupNotification('Please enter both Message ID and Emoji List', false);
                return;
            }
            
            showProcessing();
            
            try {
                const response = await fetch('/api/react-to-message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messageId, emojiList, botId })
                });
                
                const result = await response.json();
                showPopupNotification(result.message, result.success);
            } catch (error) {
                showPopupNotification('Error reacting to message', false);
            } finally {
                hideProcessing();
            }
        });

        // New Welcomer Form Handler (replaces old one)
        const newWelcomerForm = document.getElementById('welcomerForm');
        if (newWelcomerForm) {
            newWelcomerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                showProcessing();
                
                const formData = {
                    welcomer_enabled: document.getElementById('welcomerEnabled')?.checked || false,
                    welcomer_channel: document.getElementById('welcomeChannel')?.value || '',
                    welcomer_message: document.getElementById('welcomeMessage')?.value || '',
                    welcomer_embed_enabled: document.getElementById('useEmbed')?.value === 'true',
                    welcomer_embed_title: document.getElementById('embedTitle')?.value || '',
                    welcomer_embed_description: document.getElementById('embedDescription')?.value || '',
                    welcomer_embed_color: document.getElementById('embedColor')?.value || '#7c3aed',
                    welcomer_embed_thumbnail: document.getElementById('embedThumbnail')?.checked || false,
                    welcomer_embed_footer: document.getElementById('welcomeEmbedFooter')?.value || ''
                };
                
                try {
                    const response = await fetch('/api/update-welcomer-settings', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    showPopupNotification(result.message, result.success);
                } catch (error) {
                    showPopupNotification('Error updating welcomer settings', false);
                } finally {
                    hideProcessing();
                }
            });
        }

        // Auto Role Form Handler
        const autoRoleForm = document.getElementById('autoRoleForm');
        if (autoRoleForm) {
            autoRoleForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                showProcessing();
                
                const autoRoles = collectAutoRoles();
                
                const formData = {
                    auto_role_enabled: document.getElementById('autoRoleEnabled').checked,
                    auto_role_ids: autoRoles.join(',')
                };
                
                try {
                    const response = await fetch('/api/update-auto-role-settings', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    showPopupNotification(result.message, result.success);
                } catch (error) {
                    showPopupNotification('Error updating auto role settings', false);
                } finally {
                    hideProcessing();
                }
            });
        }

        // Add event listeners for toggle functions (with null checks)
        const useEmbedElement = document.getElementById('useEmbed');
        if (useEmbedElement) {
            useEmbedElement.addEventListener('change', toggleEmbedSection);
        }

        // Enter key for login
        document.getElementById('passwordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });

        // Mobile menu toggle function
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
            
            // Prevent body scroll when menu is open
            if (sidebar.classList.contains('mobile-open')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }



        // Theme toggle function
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            
            body.classList.toggle('light-theme');
            
            if (body.classList.contains('light-theme')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('theme', 'light');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.querySelector('.mobile-overlay');
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // Load saved theme
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        // React to message function
        async function reactToMessage() {
            const messageId = document.getElementById('messageReactId').value;
            const emojiList = document.getElementById('emojiList').value;
            
            if (!messageId) {
                showPopupNotification( 'Please enter a message ID', false);
                return;
            }
            
            try {
                const response = await fetch('/api/react-to-message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messageId, emojiList })
                });
                
                const result = await response.json();
                showPopupNotification( result.message, result.success);
            } catch (error) {
                showPopupNotification( 'Error reacting to message', false);
            }
        }



        // Load saved theme on page load
        document.addEventListener('DOMContentLoaded', loadSavedTheme);
        
        // Auto-bypass login when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Hide login page and show loading screen immediately
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'flex';
            
            // Start loading process
            setTimeout(async () => {
                try {
                    // Step 1: Connection
                    updateLoadingStep(1, 'active', 'Connecting...');
                    updateProgress(20);
                    updateLoadingDetails('Establishing connection to Discord bots...');
                    
                    const statsResponse = await fetch('/api/dashboard-stats');
                    if (!statsResponse.ok) {
                        throw new Error('Failed to fetch server data');
                    }
                    
                    const statsData = await statsResponse.json();
                    if (statsData.success && statsData.stats.guilds.length > 0) {
                        currentServerId = statsData.stats.guilds[0].id || '1206274128588578826';
                        updateLoadingDetails(`Connected to ${statsData.stats.guilds.length} servers`);
                    } else {
                        currentServerId = '1206274128588578826';
                        updateLoadingDetails('Connected with fallback configuration');
                    }
                    
                    updateLoadingStep(1, 'completed', 'Connected ✓');
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // Step 2: Loading Data
                    updateLoadingStep(2, 'active', 'Loading...');
                    updateProgress(50);
                    updateLoadingDetails('Loading server data and bot configuration...');
                    
                    // Load guild data and dashboard data
                    await Promise.all([
                        loadGuildData(),
                        loadDashboardData()
                    ]);
                    
                    updateLoadingDetails('Waiting for all data to be ready...');
                    
                    // Wait for guild data to be fully populated
                    let retryCount = 0;
                    const maxRetries = 20;
                    while (retryCount < maxRetries) {
                        if (guildData && guildData.roles && guildData.roles.length > 0 && 
                            guildData.channels && guildData.channels.length > 0) {
                            break;
                        }
                        await new Promise(resolve => setTimeout(resolve, 200));
                        retryCount++;
                    }
                    
                    updateLoadingStep(2, 'completed', 'Loaded ✓');
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // Step 3: Preparing Interface
                    updateLoadingStep(3, 'active', 'Preparing...');
                    updateProgress(80);
                    updateLoadingDetails('Populating dropdowns and form fields...');
                    
                    // Pre-populate all form fields before showing dashboard
                    await populateAllFormFields();
                    
                    updateProgress(95);
                    updateLoadingDetails('Finalizing dashboard interface...');
                    
                    // Initialize reaction roles system safely
                    setTimeout(() => {
                        try {
                            if (typeof initAdvancedReactionRoles === 'function') {
                                initAdvancedReactionRoles();
                            }
                        } catch (error) {
                            // Silent fail for non-critical initialization
                        }
                    }, 100);
                    
                    updateProgress(100);
                    updateLoadingStep(3, 'completed', 'Ready ✓');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Show dashboard only after everything is loaded
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    addDashboardTitleClickEvent();
                    
                    // Initialize welcome toggle functionality
                    setupWelcomeToggle();
                    
                } catch (error) {
                    console.error('Dashboard initialization failed:', error);
                    // Use fallback
                    currentServerId = '1206274128588578826';
                    updateLoadingDetails('Using fallback configuration...');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    loadDashboardData();
                    addDashboardTitleClickEvent();
                    
                    // Initialize welcome toggle functionality (fallback)
                    setupWelcomeToggle();
                }
            }, 500);
        });

        // Database tab 10-click protection
        let titleClickCount = 0;
        let clickResetTimer = null;

        // Add click event to dashboard title (after login)
        function addDashboardTitleClickEvent() {
            const dashboardTitle = document.querySelector('.header h1');
            if (dashboardTitle) {
                dashboardTitle.style.cursor = 'pointer';
                dashboardTitle.addEventListener('click', function() {
                    titleClickCount++;
                    
                    // Reset counter after 3 seconds of no clicks
                    if (clickResetTimer) {
                        clearTimeout(clickResetTimer);
                    }
                    clickResetTimer = setTimeout(() => {
                        titleClickCount = 0;
                    }, 3000);
                    
                    // Show database tab after 10 clicks
                    if (titleClickCount >= 10) {
                        const databaseTab = document.getElementById('databaseTab');
                        if (databaseTab) {
                            databaseTab.style.display = 'block';
                            showPopupNotification('Database tab unlocked!', true);
                            
                            // Update mobile navigation to include database tab
                            if (window.innerWidth <= 768) {
                                initMobileNavigation(); // Re-initialize to include database tab
                            }
                        }
                        titleClickCount = 0;
                    }
                });
            }
        }

        // Database management functions
        async function viewTable(tableName) {
            showProcessing();
            try {
                const response = await fetch(`/api/database/table/${tableName}`);
                
                const result = await response.json();
                hideProcessing();
                
                if (result.success) {
                    displayTableData(tableName, result.data);
                } else {
                    showMessage('databaseMessage', result.error || 'Failed to fetch table data', false);
                }
            } catch (error) {
                hideProcessing();
                showMessage('databaseMessage', 'Error: ' + error.message, false);
            }
        }

        function displayTableData(tableName, data) {
            const container = document.getElementById('tableDataContainer');
            const title = document.getElementById('tableTitle');
            const content = document.getElementById('tableDataContent');
            
            // Store data globally for editing functionality
            currentTableData = data;
            
            title.textContent = `${tableName.charAt(0).toUpperCase() + tableName.slice(1)} Table Data`;
            
            if (data && data.length > 0) {
                const headers = Object.keys(data[0]);
                let tableHTML = '<table style="width: 100%; border-collapse: collapse; font-size: 12px;">';
                
                // Headers
                tableHTML += '<tr>';
                headers.forEach(header => {
                    tableHTML += `<th style="border: 1px solid rgba(255,255,255,0.3); padding: 8px; background: rgba(124, 58, 237, 0.3); color: white;">${header}</th>`;
                });
                tableHTML += `<th style="border: 1px solid rgba(255,255,255,0.3); padding: 8px; background: rgba(124, 58, 237, 0.3); color: white;">Actions</th>`;
                tableHTML += '</tr>';
                
                // Data rows
                data.forEach(row => {
                    tableHTML += '<tr>';
                    headers.forEach(header => {
                        let value = row[header];
                        if (typeof value === 'object' && value !== null) {
                            // Better JSON display - show a preview of the object structure
                            try {
                                const jsonString = JSON.stringify(value, null, 2);
                                if (jsonString === '{}') {
                                    value = '{}';
                                } else if (jsonString.length > 50) {
                                    // Show object keys for better understanding
                                    const keys = Object.keys(value);
                                    if (keys.length > 0) {
                                        value = `{${keys.slice(0, 3).join(', ')}${keys.length > 3 ? '...' : ''}}`;
                                    } else {
                                        value = '{}';
                                    }
                                } else {
                                    value = jsonString;
                                }
                            } catch (e) {
                                value = String(value);
                            }
                        } else if (value === null || value === undefined) {
                            value = 'NULL';
                        } else if (typeof value === 'string' && value.length > 50) {
                            value = value.substring(0, 50) + '...';
                        }
                        tableHTML += `<td style="border: 1px solid rgba(255,255,255,0.3); padding: 8px; color: rgba(255,255,255,0.8);">${value}</td>`;
                    });
                    const rowIndex = data.indexOf(row);
                    const recordId = row.id || row.discord_id || rowIndex; // Use actual ID if available
                    tableHTML += `<td style="border: 1px solid rgba(255,255,255,0.3); padding: 8px;">
                        <button onclick="editRecord('${tableName}', ${rowIndex})" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; margin-right: 5px; font-size: 11px;">Edit</button>
                        <button onclick="deleteRecord('${tableName}', '${recordId}', ${rowIndex})" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">Delete</button>
                    </td>`;
                    tableHTML += '</tr>';
                });
                
                tableHTML += '</table>';
                content.innerHTML = tableHTML;
            } else {
                content.innerHTML = '<p style="color: rgba(255,255,255,0.6);">No data found in this table.</p>';
            }
            
            container.style.display = 'block';
        }

        function hideTableData() {
            document.getElementById('tableDataContainer').style.display = 'none';
        }

        async function deleteUser() {
            const userId = document.getElementById('deleteUserId').value.trim();
            if (!userId) {
                showMessage('databaseMessage', 'Please enter a User ID', false);
                return;
            }
            
            if (!confirm(`Are you sure you want to delete user with ID: ${userId}?`)) {
                return;
            }
            
            showProcessing();
            try {
                const response = await fetch('/api/database/delete-user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId })
                });
                
                const result = await response.json();
                hideProcessing();
                
                if (result.success) {
                    showMessage('databaseMessage', result.message || 'User deleted successfully', true);
                    document.getElementById('deleteUserId').value = '';
                } else {
                    showMessage('databaseMessage', result.error || 'Failed to delete user', false);
                }
            } catch (error) {
                hideProcessing();
                showMessage('databaseMessage', 'Error: ' + error.message, false);
            }
        }

        async function deleteBirthday() {
            const birthdayId = document.getElementById('deleteBirthdayId').value.trim();
            if (!birthdayId) {
                showMessage('databaseMessage', 'Please enter a Birthday ID', false);
                return;
            }
            
            if (!confirm(`Are you sure you want to delete birthday with ID: ${birthdayId}?`)) {
                return;
            }
            
            showProcessing();
            try {
                const response = await fetch('/api/database/delete-birthday', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ birthdayId })
                });
                
                const result = await response.json();
                hideProcessing();
                
                if (result.success) {
                    showMessage('databaseMessage', result.message || 'Birthday deleted successfully', true);
                    document.getElementById('deleteBirthdayId').value = '';
                } else {
                    showMessage('databaseMessage', result.error || 'Failed to delete birthday', false);
                }
            } catch (error) {
                hideProcessing();
                showMessage('databaseMessage', 'Error: ' + error.message, false);
            }
        }

        // Delete all records functions
        async function deleteAllUsers() {
            if (!confirm('Are you sure you want to delete ALL users? This action cannot be undone!')) {
                return;
            }
            
            showProcessing();
            try {
                const response = await fetch('/api/database/delete-all-users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                hideProcessing();
                
                if (result.success) {
                    showMessage('databaseMessage', result.message || 'All users deleted successfully', true);
                } else {
                    showMessage('databaseMessage', result.error || 'Failed to delete all users', false);
                }
            } catch (error) {
                hideProcessing();
                showMessage('databaseMessage', 'Error: ' + error.message, false);
            }
        }

        async function deleteAllBirthdays() {
            if (!confirm('Are you sure you want to delete ALL birthdays? This action cannot be undone!')) {
                return;
            }
            
            showProcessing();
            try {
                const response = await fetch('/api/database/delete-all-birthdays', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                hideProcessing();
                
                if (result.success) {
                    showMessage('databaseMessage', result.message || 'All birthdays deleted successfully', true);
                } else {
                    showMessage('databaseMessage', result.error || 'Failed to delete all birthdays', false);
                }
            } catch (error) {
                hideProcessing();
                showMessage('databaseMessage', 'Error: ' + error.message, false);
            }
        }

        // Edit record functions
        let currentEditData = null;
        let currentEditTable = null;

        // Store table data globally for editing
        let currentTableData = null;
        
        function editRecord(tableName, recordIndex) {
            currentEditTable = tableName;
            
            // Get the record data from the stored table data
            if (currentTableData && currentTableData[recordIndex]) {
                currentEditData = currentTableData[recordIndex];
            } else {
                console.error('Record not found for editing');
                return;
            }
            
            document.getElementById('editModalTitle').textContent = `Edit ${tableName.charAt(0).toUpperCase() + tableName.slice(1)} Record`;
            
            let formHTML = '';
            Object.keys(currentEditData).forEach(key => {
                if (key === 'id') return; // Skip ID field
                
                let value = currentEditData[key];
                if (typeof value === 'object' && value !== null) {
                    // Handle JSON objects properly for editing
                    try {
                        value = JSON.stringify(value, null, 2);
                    } catch (e) {
                        value = String(value);
                    }
                } else if (value === null || value === undefined) {
                    value = '';
                } else {
                    value = String(value);
                }
                
                formHTML += `
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: rgba(255,255,255,0.8); font-weight: bold;">${key}</label>
                        ${key === 'conversation_history' ? 
                            `<textarea id="edit_${key}" style="width: 100%; height: 80px; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; color: white; font-family: monospace; resize: vertical;">${value}</textarea>` :
                            `<input type="text" id="edit_${key}" value="${value}" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; color: white;">`
                        }
                    </div>
                `;
            });
            
            document.getElementById('editModalContent').innerHTML = formHTML;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditData = null;
            currentEditTable = null;
        }

        async function saveEdit() {
            if (!currentEditData || !currentEditTable) return;
            
            const updateData = {};
            Object.keys(currentEditData).forEach(key => {
                if (key === 'id') return;
                const element = document.getElementById(`edit_${key}`);
                if (element) {
                    let value = element.value;
                    if (key === 'conversation_history') {
                        try {
                            value = JSON.parse(value);
                        } catch (e) {
                            showMessage('databaseMessage', 'Invalid JSON in conversation_history', false);
                            return;
                        }
                    }
                    updateData[key] = value;
                }
            });
            
            showProcessing();
            try {
                const response = await fetch('/api/database/update-record', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        table: currentEditTable,
                        id: currentEditData.id,
                        data: updateData
                    })
                });
                
                const result = await response.json();
                hideProcessing();
                
                if (result.success) {
                    showMessage('databaseMessage', result.message || 'Record updated successfully', true);
                    closeEditModal();
                    // Refresh the table data
                    viewTable(currentEditTable);
                } else {
                    showMessage('databaseMessage', result.error || 'Failed to update record', false);
                }
            } catch (error) {
                hideProcessing();
                showMessage('databaseMessage', 'Error: ' + error.message, false);
            }
        }

        // Refresh Database Data
        function refreshDatabase() {
            showProcessing();
            try {
                // Hide any open table data
                const tableContainer = document.getElementById('tableDataContainer');
                if (tableContainer) {
                    tableContainer.style.display = 'none';
                }
                
                // Clear any displayed messages
                const databaseMessage = document.getElementById('databaseMessage');
                if (databaseMessage) {
                    databaseMessage.innerHTML = '';
                }
                
                showMessage('databaseMessage', 'Database data refreshed successfully', true);
                hideProcessing();
            } catch (error) {
                hideProcessing();
                showMessage('databaseMessage', 'Error refreshing database data', false);
            }
        }

        // Clear All Database Tables
        async function clearAllDatabase() {
            if (!confirm('⚠️ WARNING: This will permanently delete ALL data from all database tables.\n\nThis action cannot be undone. Are you absolutely sure you want to proceed?')) {
                return;
            }
            
            if (!confirm('🚨 FINAL WARNING: This will delete:\n- All user data (XP, levels, etc.)\n- All birthday records\n- All AI questions\n- All level roles\n- All reaction roles\n\nType "DELETE" to confirm (case sensitive):')) {
                return;
            }
            
            const confirmation = prompt('Please type "DELETE" to confirm (case sensitive):');
            if (confirmation !== 'DELETE') {
                showPopupNotification('Operation cancelled', false);
                return;
            }
            
            try {
                const response = await fetch('/api/database/clear-all', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                if (result.success) {
                    showPopupNotification('All database tables cleared successfully', true);
                    loadDashboardData(); // Refresh the dashboard
                    hideTableData(); // Hide any open table views
                } else {
                    showPopupNotification(result.message || 'Failed to clear database', false);
                }
            } catch (error) {
                console.error('Error clearing database:', error);
                showPopupNotification('Error clearing database', false);
            }
        }

        // Export Database Data
        async function exportDatabase() {
            showProcessing();
            try {
                const response = await fetch('/api/database/export', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error('Export failed');
                }
                
                const data = await response.json();
                
                // Create downloadable file
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `discord-bot-database-export-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showMessage('databaseMessage', 'Database exported successfully', true);
            } catch (error) {
                showMessage('databaseMessage', 'Error exporting database: ' + error.message, false);
            } finally {
                hideProcessing();
            }
        }

        // Import Database Data
        function importDatabase() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = handleFileImport;
            input.click();
        }

        async function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showProcessing();
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                
                // Confirm import
                if (!confirm('This will replace all existing data. Are you sure you want to continue?')) {
                    hideProcessing();
                    return;
                }
                
                const response = await fetch('/api/database/import', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('databaseMessage', 'Database imported successfully', true);
                    // Hide any open table data and refresh view
                    const tableContainer = document.getElementById('tableDataContainer');
                    if (tableContainer) {
                        tableContainer.style.display = 'none';
                    }
                } else {
                    showMessage('databaseMessage', 'Import failed: ' + result.error, false);
                }
            } catch (error) {
                showMessage('databaseMessage', 'Error importing database: ' + error.message, false);
            } finally {
                hideProcessing();
            }
        }

        // Auto-Create Database Tables
        async function autoCreateTables() {
            if (!confirm('This will create all missing database tables with proper schema. Continue?')) {
                return;
            }
            
            showProcessing();
            try {
                const response = await fetch('/api/database/auto-create-tables', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('databaseMessage', 'Database tables created successfully: ' + result.tablesCreated.join(', '), true);
                    showPopupNotification('Database tables auto-created successfully', true);
                } else {
                    showMessage('databaseMessage', 'Failed to create tables: ' + result.error, false);
                }
            } catch (error) {
                showMessage('databaseMessage', 'Error creating tables: ' + error.message, false);
            } finally {
                hideProcessing();
            }
        }

        // New Auto Role Functions
        function clearAllAutoRoles() {
            if (confirm('Are you sure you want to clear all auto roles?')) {
                document.getElementById('autoRolesList').innerHTML = '';
                addAutoRole(); // Add one empty role field
                showPopupNotification('All auto roles cleared', true);
            }
        }

        // New Database Table Functions
        let currentTableName = '';
        let originalTableData = null;

        function refreshTableData() {
            if (currentTableName) {
                viewTable(currentTableName);
                showPopupNotification('Table data refreshed', true);
            }
        }

        function exportTableData() {
            if (!originalTableData || !currentTableName) {
                showPopupNotification('No table data to export', false);
                return;
            }

            const blob = new Blob([JSON.stringify(originalTableData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentTableName}-table-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showPopupNotification(`${currentTableName} table exported successfully`, true);
        }

        function addTableRecord() {
            if (!currentTableName) {
                showPopupNotification('No table selected', false);
                return;
            }
            
            let formFields = '';
            switch (currentTableName) {
                case 'users':
                    formFields = `
                        <input type="text" id="addUserId" placeholder="User Discord ID" class="form-input" style="margin-bottom: 10px;">
                        <input type="text" id="addUsername" placeholder="Username" class="form-input" style="margin-bottom: 10px;">
                        <input type="number" id="addXp" placeholder="XP (default: 0)" class="form-input" style="margin-bottom: 10px;">
                        <input type="number" id="addLevel" placeholder="Level (default: 0)" class="form-input" style="margin-bottom: 10px;">
                    `;
                    break;
                case 'birthdays':
                    formFields = `
                        <input type="text" id="addUserId" placeholder="User Discord ID" class="form-input" style="margin-bottom: 10px;">
                        <input type="text" id="addUsername" placeholder="Username" class="form-input" style="margin-bottom: 10px;">
                        <input type="number" id="addDay" placeholder="Day (1-31)" min="1" max="31" class="form-input" style="margin-bottom: 10px;">
                        <input type="number" id="addMonth" placeholder="Month (1-12)" min="1" max="12" class="form-input" style="margin-bottom: 10px;">
                    `;
                    break;
                case 'level_roles':
                    formFields = `
                        <input type="number" id="addLevel" placeholder="Level" min="1" class="form-input" style="margin-bottom: 10px;">
                        <input type="text" id="addRoleId" placeholder="Role Discord ID" class="form-input" style="margin-bottom: 10px;">
                    `;
                    break;
                default:
                    showPopupNotification('Add record not supported for this table', false);
                    return;
            }
            
            const modalHtml = `
                <div id="addRecordModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: #1a1a1a; padding: 30px; border-radius: 12px; max-width: 400px; width: 90%;">
                        <h3 style="color: #7c3aed; margin-bottom: 20px;">Add New ${currentTableName.slice(0, -1).charAt(0).toUpperCase() + currentTableName.slice(0, -1).slice(1)}</h3>
                        ${formFields}
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button onclick="submitAddRecord()" class="trendy-btn trendy-btn-success">Add Record</button>
                            <button onclick="closeAddRecordModal()" class="trendy-btn trendy-btn-danger">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function closeAddRecordModal() {
            const modal = document.getElementById('addRecordModal');
            if (modal) modal.remove();
        }

        async function submitAddRecord() {
            if (!currentTableName) return;
            
            let data = {};
            switch (currentTableName) {
                case 'users':
                    data = {
                        userId: document.getElementById('addUserId').value,
                        username: document.getElementById('addUsername').value,
                        xp: parseInt(document.getElementById('addXp').value) || 0,
                        level: parseInt(document.getElementById('addLevel').value) || 0
                    };
                    if (!data.userId) {
                        showPopupNotification('User ID is required', false);
                        return;
                    }
                    break;
                case 'birthdays':
                    data = {
                        userId: document.getElementById('addUserId').value,
                        username: document.getElementById('addUsername').value,
                        day: parseInt(document.getElementById('addDay').value),
                        month: parseInt(document.getElementById('addMonth').value)
                    };
                    if (!data.userId || !data.day || !data.month) {
                        showPopupNotification('All fields are required', false);
                        return;
                    }
                    break;
                case 'level_roles':
                    data = {
                        level: parseInt(document.getElementById('addLevel').value),
                        roleId: document.getElementById('addRoleId').value
                    };
                    if (!data.level || !data.roleId) {
                        showPopupNotification('All fields are required', false);
                        return;
                    }
                    break;
            }
            
            try {
                const response = await fetch(`/api/add-record/${currentTableName}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    showPopupNotification('Record added successfully', true);
                    closeAddRecordModal();
                    viewTable(currentTableName); // Refresh table
                } else {
                    showPopupNotification(result.message || 'Failed to add record', false);
                }
            } catch (error) {
                showPopupNotification('Error adding record', false);
            }
        }

        async function bulkDeleteRecords() {
            if (!currentTableName) {
                showPopupNotification('No table selected', false);
                return;
            }
            
            if (confirm(`Are you sure you want to delete ALL records from ${currentTableName}? This action cannot be undone!`)) {
                try {
                    const response = await fetch(`/api/bulk-delete/${currentTableName}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showPopupNotification(`All records deleted from ${currentTableName}`, true);
                        viewTable(currentTableName); // Refresh table
                    } else {
                        showPopupNotification(result.message || 'Failed to delete records', false);
                    }
                } catch (error) {
                    showPopupNotification('Error deleting records', false);
                }
            }
        }

        async function deleteRecord(tableName, recordId, rowIndex) {
            if (confirm(`Are you sure you want to delete this record from ${tableName}?`)) {
                try {
                    const response = await fetch(`/api/delete-record/${tableName}/${recordId}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showPopupNotification(`Record deleted successfully`, true);
                        viewTable(tableName); // Refresh table
                    } else {
                        showPopupNotification(result.message || 'Failed to delete record', false);
                    }
                } catch (error) {
                    showPopupNotification('Error deleting record', false);
                }
            }
        }

        function filterTableData() {
            const searchTerm = document.getElementById('tableSearchInput').value.toLowerCase();
            const tableContent = document.getElementById('tableDataContent');
            const rows = tableContent.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) { // Skip header row
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let found = false;

                for (let j = 0; j < cells.length; j++) {
                    if (cells[j].textContent.toLowerCase().includes(searchTerm)) {
                        found = true;
                        break;
                    }
                }

                row.style.display = found ? '' : 'none';
            }
        }

        // Table view function
        async function viewTable(tableName) {
            currentTableName = tableName;
            showProcessing();
            
            try {
                const response = await fetch(`/api/database/table/${tableName}`);
                const data = await response.json();
                
                if (data.success) {
                    originalTableData = data.data;
                    displayTableData(tableName, data.data);
                    
                    // Show the table container
                    const tableContainer = document.getElementById('tableDataContainer');
                    if (tableContainer) {
                        tableContainer.style.display = 'block';
                    }
                    
                    // Clear search input
                    const searchInput = document.getElementById('tableSearchInput');
                    if (searchInput) {
                        searchInput.value = '';
                    }
                } else {
                    showMessage('databaseMessage', data.error, false);
                }
            } catch (error) {
                showMessage('databaseMessage', 'Error loading table data: ' + error.message, false);
            }
            
            hideProcessing();
        }
        
        // Make viewTable globally accessible
        window.viewTable = viewTable;

        function displayTableData(tableName, data) {
            currentTableData = data; // Store for editing functionality
            document.getElementById('tableTitle').textContent = `${tableName.charAt(0).toUpperCase() + tableName.slice(1)} Table`;
            
            const container = document.getElementById('tableDataContent');
            
            if (!data || data.length === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.7); text-align: center; padding: 20px;">No data found in this table.</p>';
            } else {
                const headers = Object.keys(data[0]);
                let tableHTML = `
                    <table style="width: 100%; border-collapse: collapse; color: white; font-size: 12px;">
                        <thead>
                            <tr style="background: rgba(124, 58, 237, 0.3);">
                                ${headers.map(header => `<th style="border: 1px solid rgba(255,255,255,0.2); padding: 8px; text-align: left; font-weight: bold;">${header}</th>`).join('')}
                                <th style="border: 1px solid rgba(255,255,255,0.2); padding: 8px; text-align: center; font-weight: bold;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.forEach((row, index) => {
                    tableHTML += '<tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">';
                    headers.forEach(header => {
                        let cellValue = row[header];
                        if (typeof cellValue === 'object' && cellValue !== null) {
                            cellValue = JSON.stringify(cellValue);
                        }
                        if (cellValue === null || cellValue === undefined) {
                            cellValue = '';
                        }
                        
                        // Truncate long values
                        const displayValue = String(cellValue).length > 50 ? String(cellValue).substring(0, 50) + '...' : String(cellValue);
                        
                        tableHTML += `<td style="border: 1px solid rgba(255,255,255,0.1); padding: 6px; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${displayValue}</td>`;
                    });
                    tableHTML += `
                        <td style="border: 1px solid rgba(255,255,255,0.1); padding: 6px; text-align: center;">
                            <button onclick="editRecord('${tableName}', ${index})" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 11px; margin-right: 5px; min-width: 50px;">Edit</button>
                            <button onclick="deleteRecord('${tableName}', '${row.id}', ${index})" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 11px; min-width: 50px;">Delete</button>
                        </td>
                    `;
                    tableHTML += '</tr>';
                });
                
                tableHTML += '</tbody></table>';
                container.innerHTML = tableHTML;
            }
            
            document.getElementById('tableDataContainer').style.display = 'block';
        }

        // Add error handling for unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            // Silently handle common network errors and database timeouts
            if (event.reason && event.reason.message && 
                (event.reason.message.includes('fetch') || 
                 event.reason.message.includes('network') ||
                 event.reason.message.includes('timeout'))) {
                event.preventDefault();
                return;
            }
            console.log('Promise rejection handled:', event.reason);
            event.preventDefault();
        });
    </script>
</body>
</html>